(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{if(typeof module==="object"&&module.exports){module.exports=e(require("jquery"))}else{e(window.jQuery)}}})(function(e){"use strict";e.fn.fileinputLocales={};e.fn.fileinputThemes={};String.prototype.setTokens=function(e){var i=this.toString(),t,a;for(t in e){if(e.hasOwnProperty(t)){a=new RegExp("{"+t+"}","g");i=i.replace(a,e[t])}}return i};var i,t;i={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",OBJECT_PARAMS:'<param name="controller" value="true" />\n'+'<param name="allowFullScreen" value="true" />\n'+'<param name="allowScriptAccess" value="always" />\n'+'<param name="autoPlay" value="false" />\n'+'<param name="autoStart" value="false" />\n'+'<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n'+'<span class="{previewFileIconClass}">{previewFileIcon}</span>\n'+"</div>",MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(e,i,t){return e!==undefined&&(t?e===i:e.match(i))},isIE:function(e){if(navigator.appName!=="Microsoft Internet Explorer"){return false}if(e===10){return new RegExp("msie\\s"+e,"i").test(navigator.userAgent)}var i=document.createElement("div"),t;i.innerHTML="<!--[if IE "+e+"]> <i></i> <![endif]-->";t=i.getElementsByTagName("i").length;document.body.appendChild(i);i.parentNode.removeChild(i);return t},initModal:function(i){var t=e("body");if(t.length){i.appendTo(t)}},isEmpty:function(i,t){return i===undefined||i===null||i.length===0||t&&e.trim(i)===""},isArray:function(e){return Array.isArray(e)||Object.prototype.toString.call(e)==="[object Array]"},ifSet:function(e,i,t){t=t||"";return i&&typeof i==="object"&&e in i?i[e]:t},cleanArray:function(e){if(!(e instanceof Array)){e=[]}return e.filter(function(e){return e!==undefined&&e!==null})},spliceArray:function(e,i){var t,a=0,r=[];if(!(e instanceof Array)){return[]}for(t=0;t<e.length;t++){if(t!==i){r[a]=e[t];a++}}return r},getNum:function(e,i){i=i||0;if(typeof e==="number"){return e}if(typeof e==="string"){e=parseFloat(e)}return isNaN(e)?i:e},hasFileAPISupport:function(){return!!(window.File&&window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!i.isIE(9)&&(e.draggable!==undefined||e.ondragstart!==undefined&&e.ondrop!==undefined)},hasFileUploadSupport:function(){return i.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return false}},hasArrayBufferViewSupport:function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(e){return false}},dataURI2Blob:function(e){var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=i.hasBlobSupport(),r,n,l,o,s,d,f=(a||t)&&window.atob&&window.ArrayBuffer&&window.Uint8Array;if(!f){return null}if(e.split(",")[0].indexOf("base64")>=0){r=atob(e.split(",")[1])}else{r=decodeURIComponent(e.split(",")[1])}n=new ArrayBuffer(r.length);l=new Uint8Array(n);for(o=0;o<r.length;o+=1){l[o]=r.charCodeAt(o)}s=e.split(",")[0].split(":")[1].split(";")[0];if(a){return new Blob([i.hasArrayBufferViewSupport()?l:n],{type:s})}d=new t;d.append(n);return d.getBlob(s)},addCss:function(e,i){e.removeClass(i).addClass(i)},getElement:function(t,a,r){return i.isEmpty(t)||i.isEmpty(t[a])?r:e(t[a])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(Math.random()*100)},htmlEncode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(i,t){var a=i;if(!t){return a}e.each(t,function(e,i){if(typeof i==="function"){i=i()}a=a.split(e).join(i)});return a},cleanMemory:function(e){var t=e.is("img")?e.attr("src"):e.find("source").attr("src");i.objUrl.revokeObjectURL(t)},findFileName:function(e){var i=e.lastIndexOf("/");if(i===-1){i=e.lastIndexOf("\\")}return e.split(e.substring(i,i+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var t=document,a=t.documentElement;if(a&&e&&!i.checkFullScreen()){if(a.requestFullscreen){a.requestFullscreen()}else if(a.msRequestFullscreen){a.msRequestFullscreen()}else if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else if(a.webkitRequestFullscreen){a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(t.exitFullscreen){t.exitFullscreen()}else if(t.msExitFullscreen){t.msExitFullscreen()}else if(t.mozCancelFullScreen){t.mozCancelFullScreen()}else if(t.webkitExitFullscreen){t.webkitExitFullscreen()}}},moveArray:function(e,i,t){if(t>=e.length){var a=t-e.length;while(a--+1){e.push(undefined)}}e.splice(t,0,e.splice(i,1)[0]);return e},cleanZoomCache:function(e){var i=e.closest(".kv-zoom-cache-theme");if(!i.length){i=e.closest(".kv-zoom-cache")}i.remove()},setOrientation:function(e,i){var t=new DataView(e),a=0,r=1,n,l,o;if(t.getUint16(a)!==65496||e.length<2){if(i){i()}return}a+=2;n=t.byteLength;while(a<n-2){l=t.getUint16(a);a+=2;switch(l){case 65505:o=t.getUint16(a);n=o-a;a+=2;break;case 274:r=t.getUint16(a+6,false);n=0;break}}if(i){i(r)}},validateOrientation:function(e,t){if(!window.FileReader||!window.DataView){return}var a=new FileReader,r;a.onloadend=function(){r=a.result;i.setOrientation(r,t)};a.readAsArrayBuffer(e)},adjustOrientedImage:function(e,i){var t,a,r;if(!e.hasClass("is-portrait-gt4")){return}if(i){e.css({width:e.parent().height()});return}else{e.css({height:"auto",width:e.height()})}t=e.parent().offset().top;a=e.offset().top;r=t-a;e.css("margin-top",r)}};t=function(t,a){var r=this;r.$element=e(t);r.$parent=r.$element.parent();if(!r._validate()){return}r.isPreviewable=i.hasFileAPISupport();r.isIE9=i.isIE(9);r.isIE10=i.isIE(10);if(r.isPreviewable||r.isIE9){r._init(a);r._listen()}r.$element.removeClass("file-loading")};t.prototype={constructor:t,_cleanup:function(){var e=this;e.reader=null;e.formdata={};e.uploadCount=0;e.uploadStatus={};e.uploadLog=[];e.uploadAsyncCount=0;e.loadedImages=[];e.totalImagesCount=0;e.ajaxRequests=[];e.clearStack();e.fileInputCleared=false;e.fileBatchCompleted=true;if(!e.isPreviewable){e.showPreview=false}e.isError=false;e.ajaxAborted=false;e.cancelling=false},_init:function(t,a){var r=this,n=r.$element,l,o,s;r.options=t;e.each(t,function(e,t){switch(e){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":r[e]=i.getNum(t);break;default:r[e]=t;break}});if(r.rtl){s=r.previewZoomButtonIcons.prev;r.previewZoomButtonIcons.prev=r.previewZoomButtonIcons.next;r.previewZoomButtonIcons.next=s}if(!a){r._cleanup()}r.$form=n.closest("form");r._initTemplateDefaults();r.uploadFileAttr=!i.isEmpty(n.attr("name"))?n.attr("name"):"file_data";o=r._getLayoutTemplate("progress");r.progressTemplate=o.replace("{class}",r.progressClass);r.progressCompleteTemplate=o.replace("{class}",r.progressCompleteClass);r.progressErrorTemplate=o.replace("{class}",r.progressErrorClass);r.dropZoneEnabled=i.hasDragDropSupport()&&r.dropZoneEnabled;r.isDisabled=n.attr("disabled")||n.attr("readonly");if(r.isDisabled){n.attr("disabled",true)}r.isUploadable=i.hasFileUploadSupport()&&!i.isEmpty(r.uploadUrl);r.isClickable=r.browseOnZoneClick&&r.showPreview&&(r.isUploadable&&r.dropZoneEnabled||!i.isEmpty(r.defaultPreviewContent));r.slug=typeof t.slugCallback==="function"?t.slugCallback:r._slugDefault;r.mainTemplate=r.showCaption?r._getLayoutTemplate("main1"):r._getLayoutTemplate("main2");r.captionTemplate=r._getLayoutTemplate("caption");r.previewGenericTemplate=r._getPreviewTemplate("generic");if(!r.imageCanvas&&r.resizeImage&&(r.maxImageWidth||r.maxImageHeight)){r.imageCanvas=document.createElement("canvas");r.imageCanvasContext=r.imageCanvas.getContext("2d")}if(i.isEmpty(n.attr("id"))){n.attr("id",i.uniqId())}r.namespace=".fileinput_"+n.attr("id").replace(/-/g,"_");if(r.$container===undefined){r.$container=r._createContainer()}else{r._refreshContainer()}l=r.$container;r.$dropZone=l.find(".file-drop-zone");r.$progress=l.find(".kv-upload-progress");r.$btnUpload=l.find(".fileinput-upload");r.$captionContainer=i.getElement(t,"elCaptionContainer",l.find(".file-caption"));r.$caption=i.getElement(t,"elCaptionText",l.find(".file-caption-name"));r.$previewContainer=i.getElement(t,"elPreviewContainer",l.find(".file-preview"));r.$preview=i.getElement(t,"elPreviewImage",l.find(".file-preview-thumbnails"));r.$previewStatus=i.getElement(t,"elPreviewStatus",l.find(".file-preview-status"));r.$errorContainer=i.getElement(t,"elErrorContainer",r.$previewContainer.find(".kv-fileinput-error"));if(!i.isEmpty(r.msgErrorClass)){i.addCss(r.$errorContainer,r.msgErrorClass)}if(!a){r.$errorContainer.hide();r.previewInitId="preview-"+i.uniqId();r._initPreviewCache();r._initPreview(true);r._initPreviewActions();r._setFileDropZoneTitle();if(r.$parent.hasClass("file-loading")){r.$container.insertBefore(r.$parent);r.$parent.remove()}}if(n.attr("disabled")){r.disable()}r._initZoom();if(r.hideThumbnailContent){i.addCss(r.$preview,"hide-content")}},_initTemplateDefaults:function(){var t=this,a,r,n,l,o,s,d,f,c,u,p,m,g,h,v,w,_,b,C,y,x,E,T,S,F,k,I,P,A,z,D,$,U,j,B,R,O;a="{preview}\n"+'<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n'+'<div class="input-group {class}">\n'+"   {caption}\n"+'   <div class="input-group-btn">\n'+"       {remove}\n"+"       {cancel}\n"+"       {upload}\n"+"       {browse}\n"+"   </div>\n"+"</div>";r='{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n';n='<div class="file-preview {class}">\n'+"    {close}"+'    <div class="{dropClass}">\n'+'    <div class="file-preview-thumbnails">\n'+"    </div>\n"+'    <div class="clearfix"></div>'+'    <div class="file-preview-status text-center text-success"></div>\n'+'    <div class="kv-fileinput-error"></div>\n'+"    </div>\n"+"</div>";o='<button type="button" class="close fileinput-remove">&times;</button>\n';l='<i class="glyphicon glyphicon-file kv-caption-icon"></i>';s='<div tabindex="500" class="form-control file-caption {class}">\n'+'   <div class="file-caption-name"></div>\n'+"</div>\n";d='<button type="{type}" tabindex="500" title="{title}" class="{css}" '+"{status}>{icon} {label}</button>";f='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>';c='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>';u='<div id="'+i.MODAL_ID+'" class="file-zoom-dialog modal fade" '+'tabindex="-1" aria-labelledby="'+i.MODAL_ID+'Label"></div>';p='<div class="modal-dialog modal-lg{rtl}" role="document">\n'+'  <div class="modal-content">\n'+'    <div class="modal-header">\n'+'      <h5 class="modal-title">{heading}</h5>\n'+'      <span class="kv-zoom-title"></span>\n'+'      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n'+"    </div>\n"+'    <div class="modal-body">\n'+'      <div class="floating-buttons"></div>\n'+'      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n'+"{prev} {next}\n"+"    </div>\n"+"  </div>\n"+"</div>\n";m='<div class="progress">\n'+'    <div class="{class}" role="progressbar"'+' aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n'+"        {status}\n"+"     </div>\n"+"</div>";g=" <samp>({sizeText})</samp>";h='<div class="file-thumbnail-footer">\n'+'    <div class="file-footer-caption" title="{caption}">\n'+'        <div class="file-caption-info">{caption}</div>\n'+'        <div class="file-size-info">{size}</div>\n'+"    </div>\n"+"    {progress}\n{indicator}\n{actions}\n"+"</div>";v='<div class="file-actions">\n'+'    <div class="file-footer-buttons">\n'+"        {download} {upload} {delete} {zoom} {other}"+"    </div>\n"+"</div>\n"+"{drag}\n"+'<div class="clearfix"></div>';w='<button type="button" class="kv-file-remove {removeClass}" '+'title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n';_='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">'+"{uploadIcon}</button>";b='<a href="{downloadUrl}" class="{downloadClass}" title="{downloadTitle}" '+'download="{caption}">{downloadIcon}</a>';C='<button type="button" class="kv-file-zoom {zoomClass}" '+'title="{zoomTitle}">{zoomIcon}</button>';y='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>';x='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>';E='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}"'+' data-template="{template}"';T=E+'><div class="kv-file-content">\n';S=E+' title="{caption}"><div class="kv-file-content">\n';F="</div>{footer}\n</div>\n";k="{content}\n";I='<div class="kv-preview-data file-preview-html" title="{caption}" {style}>{data}</div>\n';P='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" '+'alt="{caption}" {style}>\n';A='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly {style}>'+"{data}</textarea {style}>\n";z='<video class="kv-preview-data file-preview-video" controls {style}>\n'+'<source src="{data}" type="{type}">\n'+i.DEFAULT_PREVIEW+"\n</video>\n";D='<audio class="kv-preview-data file-preview-audio" controls {style}>\n<source src="{data}" '+'type="{type}">\n'+i.DEFAULT_PREVIEW+"\n</audio>\n";$='<object class="kv-preview-data file-preview-flash file-object" type="application/x-shockwave-flash" '+'data="{data}" {style}>\n'+i.OBJECT_PARAMS+" "+i.DEFAULT_PREVIEW+"\n</object>\n";U='<object class="kv-preview-data file-preview-object file-object {typeCss}" '+'data="{data}" type="{type}" {style}>\n'+'<param name="movie" value="{caption}" />\n'+i.OBJECT_PARAMS+" "+i.DEFAULT_PREVIEW+"\n</object>\n";j='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf" {style}>\n';B='<div class="kv-preview-data file-preview-other-frame" {style}>\n'+i.DEFAULT_PREVIEW+"\n</div>\n";R='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>';O={width:"100%",height:"100%","min-height":"480px"};t.defaults={layoutTemplates:{main1:a,main2:r,preview:n,close:o,fileIcon:l,caption:s,modalMain:u,modal:p,progress:m,size:g,footer:h,indicator:x,actions:v,actionDelete:w,actionUpload:_,actionDownload:b,actionZoom:C,actionDrag:y,btnDefault:d,btnLink:f,btnBrowse:c,zoomCache:R},previewMarkupTags:{tagBefore1:T,tagBefore2:S,tagAfter:F},previewContentTemplates:{generic:k,html:I,image:P,text:A,video:z,audio:D,flash:$,object:U,pdf:j,other:B},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"213px",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:O,text:O,video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:O,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(e,t){return i.compare(e,"image.*")||i.compare(t,/\.(gif|png|jpe?g)$/i)},html:function(e,t){return i.compare(e,"text/html")||i.compare(t,/\.(htm|html)$/i)},text:function(e,t){return i.compare(e,"text.*")||i.compare(t,/\.(xml|javascript)$/i)||i.compare(t,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(e,t){return i.compare(e,"video.*")&&(i.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||i.compare(t,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,t){return i.compare(e,"audio.*")&&(i.compare(t,/(ogg|mp3|mp?g|wav)$/i)||i.compare(t,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,t){return i.compare(e,"application/x-shockwave-flash",true)||i.compare(t,/\.(swf)$/i)},pdf:function(e,t){return i.compare(e,"application/pdf",true)||i.compare(t,/\.(pdf)$/i)},object:function(){return true},other:function(){return true}},fileActionSettings:{showRemove:true,showUpload:true,showDownload:true,showZoom:true,showDrag:true,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-sm btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-sm btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-sm btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-sm btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}};e.each(t.defaults,function(i,a){if(i==="allowedPreviewTypes"){if(t.allowedPreviewTypes===undefined){t.allowedPreviewTypes=a}return}t[i]=e.extend(true,{},a,t[i])});t._initPreviewTemplates()},_initPreviewTemplates:function(){var t=this,a=t.defaults,r=t.previewMarkupTags,n,l=r.tagAfter;e.each(a.previewContentTemplates,function(e,a){if(i.isEmpty(t.previewTemplates[e])){n=r.tagBefore2;if(e==="generic"||e==="image"||e==="html"||e==="text"){n=r.tagBefore1}t.previewTemplates[e]=n+a+l}})},_initPreviewCache:function(){var t=this;t.previewCache={data:{},init:function(){var e=t.initialPreview;if(e.length>0&&!i.isArray(e)){e=e.split(t.initialPreviewDelimiter)}t.previewCache.data={content:e,config:t.initialPreviewConfig,tags:t.initialPreviewThumbTags}},count:function(){return!!t.previewCache.data&&!!t.previewCache.data.content?t.previewCache.data.content.length:0},get:function(a,r){var n="init_"+a,l=t.previewCache.data,o=l.config[a],s=l.content[a],d=t.previewInitId+"-"+n,f,c,u,p,m,g,h,v=i.ifSet("previewAsData",o,t.initialPreviewAsData),w=function(e,a,r,n,l,o,s,d,f){d=" file-preview-initial "+i.SORT_CSS+(d?" "+d:"");return t._generatePreviewTemplate(e,a,r,n,l,false,null,d,o,s,f)};if(!s){return""}r=r===undefined?true:r;u=i.ifSet("type",o,t.initialPreviewFileType||"generic");m=i.ifSet("filename",o,i.ifSet("caption",o));g=i.ifSet("filetype",o,u);p=t.previewCache.footer(a,r,o&&o.size||null);h=i.ifSet("frameClass",o);if(v){f=w(u,s,m,g,d,p,n,h)}else{f=w("generic",s,m,g,d,p,n,h,u).setTokens({content:l.content[a]})}if(l.tags.length&&l.tags[a]){f=i.replaceTags(f,l.tags[a])}if(!i.isEmpty(o)&&!i.isEmpty(o.frameAttr)){c=e(document.createElement("div")).html(f);c.find(".file-preview-initial").attr(o.frameAttr);f=c.html();c.remove()}return f},add:function(e,a,r,n){var l=t.previewCache.data,o;if(!i.isArray(e)){e=e.split(t.initialPreviewDelimiter)}if(n){o=l.content.push(e)-1;l.config[o]=a;l.tags[o]=r}else{o=e.length-1;l.content=e;l.config=a;l.tags=r}t.previewCache.data=l;return o},set:function(e,a,r,n){var l=t.previewCache.data,o,s;if(!e||!e.length){return}if(!i.isArray(e)){e=e.split(t.initialPreviewDelimiter)}s=e.filter(function(e){return e!==null});if(!s.length){return}if(l.content===undefined){l.content=[]}if(l.config===undefined){l.config=[]}if(l.tags===undefined){l.tags=[]}if(n){for(o=0;o<e.length;o++){if(e[o]){l.content.push(e[o])}}for(o=0;o<a.length;o++){if(a[o]){l.config.push(a[o])}}for(o=0;o<r.length;o++){if(r[o]){l.tags.push(r[o])}}}else{l.content=e;l.config=a;l.tags=r}t.previewCache.data=l},unset:function(e){var i=t.previewCache.count();if(!i){return}if(i===1){t.previewCache.data.content=[];t.previewCache.data.config=[];t.previewCache.data.tags=[];t.initialPreview=[];t.initialPreviewConfig=[];t.initialPreviewThumbTags=[];return}t.previewCache.data.content.splice(e,1);t.previewCache.data.config.splice(e,1);t.previewCache.data.tags.splice(e,1)},out:function(){var e="",i,a=t.previewCache.count(),r;if(a===0){return{content:"",caption:""}}for(r=0;r<a;r++){e+=t.previewCache.get(r)}i=t._getMsgSelected(a);return{content:e,caption:i}},footer:function(e,a,r){var n=t.previewCache.data;if(!n||!n.config||n.config.length===0||i.isEmpty(n.config[e])){return""}a=a===undefined?true:a;var l=n.config[e],o=i.ifSet("caption",l),s,d=i.ifSet("width",l,"auto"),f=i.ifSet("url",l,false),c=i.ifSet("key",l,null),u=t.fileActionSettings,p=t.initialPreviewShowDelete||false,m=l.downloadUrl||t.initialPreviewDownloadUrl||"",g=l.filename||l.caption||"",h=!!m,v=i.ifSet("showDelete",l,i.ifSet("showDelete",u,p)),w=i.ifSet("showDownload",l,i.ifSet("showDownload",u,h)),_=i.ifSet("showZoom",l,i.ifSet("showZoom",u,true)),b=i.ifSet("showDrag",l,i.ifSet("showDrag",u,true)),C=f===false&&a;w=w&&l.downloadUrl!==false&&!!m;s=t._renderFileActions(false,w,v,_,b,C,f,c,true,m,g);return t._getLayoutTemplate("footer").setTokens({progress:t._renderThumbProgress(),actions:s,caption:o,size:t._getSize(r),width:d,indicator:""})}};t.previewCache.init()},_handler:function(e,i,t){var a=this,r=a.namespace,n=i.split(" ").join(r+" ")+r;if(!e||!e.length){return}e.off(n).on(n,t)},_log:function(e){var i=this,t=i.$element.attr("id");if(t){e='"'+t+'": '+e}if(typeof window.console.log!=="undefined"){window.console.log(e)}else{window.alert(e)}},_validate:function(){var e=this,i=e.$element.attr("type")==="file";if(!i){e._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.')}return i},_errorsExist:function(){var i=this,t,a=i.$errorContainer.find("li");if(a.length){return true}t=e(document.createElement("div")).html(i.$errorContainer.html());t.find(".kv-error-close").remove();t.find("ul").remove();return!!e.trim(t.text()).length},_errorHandler:function(e,i){var t=this,a=e.target.error,r=function(e){t._showError(e.replace("{name}",i))};if(a.code===a.NOT_FOUND_ERR){r(t.msgFileNotFound)}else if(a.code===a.SECURITY_ERR){r(t.msgFileSecured)}else if(a.code===a.NOT_READABLE_ERR){r(t.msgFileNotReadable)}else if(a.code===a.ABORT_ERR){r(t.msgFilePreviewAborted)}else{r(t.msgFilePreviewError)}},_addError:function(e){var i=this,t=i.$errorContainer;if(e&&t.length){t.html(i.errorCloseButton+e);i._handler(t.find(".kv-error-close"),"click",function(){t.fadeOut("slow")})}},_resetErrors:function(e){var i=this,t=i.$errorContainer;i.isError=false;i.$container.removeClass("has-error");t.html("");if(e){t.fadeOut("slow")}else{t.hide()}},_showFolderError:function(e){var t=this,a=t.$errorContainer,r;if(!e){return}r=t.msgFoldersNotAllowed.replace("{n}",e);t._addError(r);i.addCss(t.$container,"has-error");a.fadeIn(800);t._raise("filefoldererror",[e,r])},_showUploadError:function(e,t,a){var r=this,n=r.$errorContainer,l=a||"fileuploaderror",o=t&&t.id?'<li data-file-id="'+t.id+'">'+e+"</li>":"<li>"+e+"</li>";if(n.find("ul").length===0){r._addError("<ul>"+o+"</ul>")}else{n.find("ul").append(o)}n.fadeIn(800);r._raise(l,[t,e]);r.$container.removeClass("file-input-new");i.addCss(r.$container,"has-error");return true},_showError:function(e,t,a){var r=this,n=r.$errorContainer,l=a||"fileerror";t=t||{};t.reader=r.reader;r._addError(e);n.fadeIn(800);r._raise(l,[t,e]);if(!r.isUploadable){r._clearFileInput()}r.$container.removeClass("file-input-new");i.addCss(r.$container,"has-error");r.$btnUpload.attr("disabled",true);return true},_noFilesError:function(e){var t=this,a=t.minFileCount>1?t.filePlural:t.fileSingle,r=t.msgFilesTooLess.replace("{n}",t.minFileCount).replace("{files}",a),n=t.$errorContainer;t._addError(r);t.isError=true;t._updateFileDetails(0);n.fadeIn(800);t._raise("fileerror",[e,r]);t._clearFileInput();i.addCss(t.$container,"has-error")},_parseError:function(i,t,a,r){var n=this,l=e.trim(a+""),o,s=t.responseJSON!==undefined&&t.responseJSON.error!==undefined?t.responseJSON.error:t.responseText;if(n.cancelling&&n.msgUploadAborted){l=n.msgUploadAborted}if(n.showAjaxErrorDetails&&s){s=e.trim(s.replace(/\n\s*\n/g,"\n"));o=s.length?"<pre>"+s+"</pre>":"";l+=l?o:s}if(!l){l=n.msgAjaxError.replace("{operation}",i)}n.cancelling=false;return r?"<b>"+r+": </b>"+l:l},_parseFileType:function(e){var t=this,a,r,n,l,o=t.allowedPreviewTypes||[];for(l=0;l<o.length;l++){n=o[l];a=t.fileTypeSettings[n];r=a(e.type,e.name)?n:"";if(!i.isEmpty(r)){return r}}return"other"},_getPreviewIcon:function(i){var t=this,a,r=null;if(i&&i.indexOf(".")>-1){a=i.split(".").pop();if(t.previewFileIconSettings){r=t.previewFileIconSettings[a]||t.previewFileIconSettings[a.toLowerCase()]||null}if(t.previewFileExtSettings){e.each(t.previewFileExtSettings,function(e,i){if(t.previewFileIconSettings[e]&&i(a)){r=t.previewFileIconSettings[e];return}})}}return r},_parseFilePreviewIcon:function(e,i){var t=this,a=t._getPreviewIcon(i)||t.previewFileIcon,r=e;if(r.indexOf("{previewFileIcon}")>-1){r=r.setTokens({previewFileIconClass:t.previewFileIconClass,previewFileIcon:a})}return r},_raise:function(i,t){var a=this,r=e.Event(i);if(t!==undefined){a.$element.trigger(r,t)}else{a.$element.trigger(r)}if(r.isDefaultPrevented()||r.result===false){return false}switch(i){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:if(!a.ajaxAborted){a.ajaxAborted=r.result}break}return true},_listenFullScreen:function(e){var i=this,t=i.$modal,a,r;if(!t||!t.length){return}a=t&&t.find(".btn-fullscreen");r=t&&t.find(".btn-borderless");if(!a.length||!r.length){return}a.removeClass("active").attr("aria-pressed","false");r.removeClass("active").attr("aria-pressed","false");if(e){a.addClass("active").attr("aria-pressed","true")}else{r.addClass("active").attr("aria-pressed","true")}if(t.hasClass("file-zoom-fullscreen")){i._maximizeZoomDialog()}else{if(e){i._maximizeZoomDialog()}else{r.removeClass("active").attr("aria-pressed","false")}}},_listen:function(){var t=this,a=t.$element,r=t.$form,n=t.$container,l;t._handler(a,"change",e.proxy(t._change,t));if(t.showBrowse){t._handler(t.$btnFile,"click",e.proxy(t._browse,t))}t._handler(n.find(".fileinput-remove:not([disabled])"),"click",e.proxy(t.clear,t));t._handler(n.find(".fileinput-cancel"),"click",e.proxy(t.cancel,t));t._initDragDrop();t._handler(r,"reset",e.proxy(t.clear,t));if(!t.isUploadable){t._handler(r,"submit",e.proxy(t._submitForm,t))}t._handler(t.$container.find(".fileinput-upload"),"click",e.proxy(t._uploadClick,t));t._handler(e(window),"resize",function(){t._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});l="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";t._handler(e(document),l,function(){t._listenFullScreen(i.checkFullScreen())});t._autoFitContent();t._initClickable()},_autoFitContent:function(){var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=this,a=i<400?t.previewSettingsSmall||t.defaults.previewSettingsSmall:t.previewSettings||t.defaults.previewSettings,r;e.each(a,function(e,i){r=".file-preview-frame .file-preview-"+e;t.$preview.find(r+".kv-preview-data,"+r+" .kv-preview-data").css(i)})},_initClickable:function(){var t=this,a;if(!t.isClickable){return}a=t.isUploadable?t.$dropZone:t.$preview.find(".file-default-preview");i.addCss(a,"clickable");a.attr("tabindex",-1);t._handler(a,"click",function(i){var r=e(i.target);if(!r.parents(".file-preview-thumbnails").length||r.parents(".file-default-preview").length){t.$element.trigger("click");a.blur()}})},_initDragDrop:function(){var i=this,t=i.$dropZone;if(i.isUploadable&&i.dropZoneEnabled&&i.showPreview){i._handler(t,"dragenter dragover",e.proxy(i._zoneDragEnter,i));i._handler(t,"dragleave",e.proxy(i._zoneDragLeave,i));i._handler(t,"drop",e.proxy(i._zoneDrop,i));i._handler(e(document),"dragenter dragover drop",i._zoneDragDropInit)}},_zoneDragDropInit:function(e){e.stopPropagation();e.preventDefault()},_zoneDragEnter:function(t){var a=this,r=e.inArray("Files",t.originalEvent.dataTransfer.types)>-1;a._zoneDragDropInit(t);if(a.isDisabled||!r){t.originalEvent.dataTransfer.effectAllowed="none";t.originalEvent.dataTransfer.dropEffect="none";return}i.addCss(a.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var i=this;i._zoneDragDropInit(e);if(i.isDisabled){return}i.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var t=this;e.preventDefault();if(t.isDisabled||i.isEmpty(e.originalEvent.dataTransfer.files)){return}t._change(e,"dragdrop");t.$dropZone.removeClass("file-highlighted")},_uploadClick:function(e){var t=this,a=t.$container.find(".fileinput-upload"),r,n=!a.hasClass("disabled")&&i.isEmpty(a.attr("disabled"));if(e&&e.isDefaultPrevented()){return}if(!t.isUploadable){if(n&&a.attr("type")!=="submit"){r=a.closest("form");if(r.length){r.trigger("submit")}e.preventDefault()}return}e.preventDefault();if(n){t.upload()}},_submitForm:function(){var e=this;return e._isFileSelectionValid()&&!e._abort({})},_clearPreview:function(){var t=this,a=t.$preview,r=t.showUploadedThumbs?t.getFrames(":not(.file-preview-success)"):t.getFrames();r.each(function(){var t=e(this);t.remove();i.cleanZoomCache(a.find("#zoom-"+t.attr("id")))});if(!t.getFrames().length||!t.showPreview){t._resetUpload()}t._validateDefaultPreview()},_initSortable:function(){var t=this,a=t.$preview,r,n="."+i.SORT_CSS;if(!window.KvSortable||a.find(n).length===0){return}r={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:false,draggable:n,onSort:function(a){var r=a.oldIndex,n=a.newIndex,l,o;t.initialPreview=i.moveArray(t.initialPreview,r,n);t.initialPreviewConfig=i.moveArray(t.initialPreviewConfig,r,n);t.previewCache.init();for(var s=0;s<t.initialPreviewConfig.length;s++){if(t.initialPreviewConfig[s]!==null){l=t.initialPreviewConfig[s].key;o=e(".kv-file-remove[data-key='"+l+"']").closest(i.FRAMES);o.attr("data-fileindex","init_"+s).attr("data-fileindex","init_"+s)}}t._raise("filesorted",{previewId:e(a.item).attr("id"),oldIndex:r,newIndex:n,stack:t.initialPreviewConfig})}};if(a.data("kvsortable")){a.kvsortable("destroy")}e.extend(true,r,t.fileActionSettings.dragSettings);a.kvsortable(r)},_setPreviewContent:function(e){var i=this;i.$preview.html(e);i._autoFitContent()},_initPreview:function(e){var t=this,a=t.initialCaption||"",r;if(!t.previewCache.count()){t._clearPreview();if(e){t._setCaption(a)}else{t._initCaption()}return}r=t.previewCache.out();a=e&&t.initialCaption?t.initialCaption:r.caption;t._setPreviewContent(r.content);t._setInitThumbAttr();t._setCaption(a);t._initSortable();if(!i.isEmpty(r.content)){t.$container.removeClass("file-input-new")}},_getZoomButton:function(e){var i=this,t=i.previewZoomButtonIcons[e],a=i.previewZoomButtonClasses[e],r=' title="'+(i.previewZoomButtonTitles[e]||"")+'" ',n=r+(e==="close"?' data-dismiss="modal" aria-hidden="true"':"");
if(e==="fullscreen"||e==="borderless"||e==="toggleheader"){n+=' data-toggle="button" aria-pressed="false" autocomplete="off"'}return'<button type="button" class="'+a+" btn-"+e+'"'+n+">"+t+"</button>"},_getModalContent:function(){var e=this;return e._getLayoutTemplate("modal").setTokens({rtl:e.rtl?" kv-rtl":"",zoomFrameClass:e.frameClass,heading:e.msgZoomModalHeading,prev:e._getZoomButton("prev"),next:e._getZoomButton("next"),toggleheader:e._getZoomButton("toggleheader"),fullscreen:e._getZoomButton("fullscreen"),borderless:e._getZoomButton("borderless"),close:e._getZoomButton("close")})},_listenModalEvent:function(e){var t=this,a=t.$modal,r=function(e){return{sourceEvent:e,previewId:a.data("previewId"),modal:a}};a.on(e+".bs.modal",function(n){var l=a.find(".btn-fullscreen"),o=a.find(".btn-borderless");t._raise("filezoom"+e,r(n));if(e==="shown"){o.removeClass("active").attr("aria-pressed","false");l.removeClass("active").attr("aria-pressed","false");if(a.hasClass("file-zoom-fullscreen")){t._maximizeZoomDialog();if(i.checkFullScreen()){l.addClass("active").attr("aria-pressed","true")}else{o.addClass("active").attr("aria-pressed","true")}}}})},_initZoom:function(){var t=this,a,r=t._getLayoutTemplate("modalMain"),n="#"+i.MODAL_ID;if(!t.showPreview){return}t.$modal=e(n);if(!t.$modal||!t.$modal.length){a=e(document.createElement("div")).html(r).insertAfter(t.$container);t.$modal=e(n).insertBefore(a);a.remove()}i.initModal(t.$modal);t.$modal.html(t._getModalContent());e.each(i.MODAL_EVENTS,function(e,i){t._listenModalEvent(i)})},_initZoomButtons:function(){var i=this,t=i.$modal.data("previewId")||"",a,r,n=i.getFrames().toArray(),l=n.length,o=i.$modal.find(".btn-prev"),s=i.$modal.find(".btn-next");if(n.length<2){o.hide();s.hide();return}else{o.show();s.show()}if(!l){return}a=e(n[0]);r=e(n[l-1]);o.removeAttr("disabled");s.removeAttr("disabled");if(a.length&&a.attr("id")===t){o.attr("disabled",true)}if(r.length&&r.attr("id")===t){s.attr("disabled",true)}},_maximizeZoomDialog:function(){var i=this,t=i.$modal,a=t.find(".modal-header:visible"),r=t.find(".modal-footer:visible"),n=t.find(".modal-body"),l=e(window).height(),o=0;t.addClass("file-zoom-fullscreen");if(a&&a.length){l-=a.outerHeight(true)}if(r&&r.length){l-=r.outerHeight(true)}if(n&&n.length){o=n.outerHeight(true)-n.height();l-=o}t.find(".kv-zoom-body").height(l)},_resizeZoomDialog:function(e){var t=this,a=t.$modal,r=a.find(".btn-fullscreen"),n=a.find(".btn-borderless");if(a.hasClass("file-zoom-fullscreen")){i.toggleFullScreen(false);if(!e){if(!r.hasClass("active")){a.removeClass("file-zoom-fullscreen");t.$modal.find(".kv-zoom-body").css("height",t.zoomModalHeight)}else{r.removeClass("active").attr("aria-pressed","false")}}else{if(!r.hasClass("active")){a.removeClass("file-zoom-fullscreen");t._resizeZoomDialog(true);if(n.hasClass("active")){n.removeClass("active").attr("aria-pressed","false")}}}}else{if(!e){t._maximizeZoomDialog();return}i.toggleFullScreen(true)}a.focus()},_setZoomContent:function(t,a){var r=this,n,l,o,s,d,f,c,u=t.attr("id"),p=r.$modal,m=p.find(".btn-prev"),g=p.find(".btn-next"),h,v=p.find(".btn-fullscreen"),w=p.find(".btn-borderless"),_,b,C=p.find(".btn-toggleheader"),y=r.$preview.find("#zoom-"+u);l=y.attr("data-template")||"generic";n=y.find(".kv-file-content");o=n.length?n.html():"";_=t.data("caption")||"";b=t.data("size")||"";s=_+" "+b;p.find(".kv-zoom-title").html(s);d=p.find(".kv-zoom-body");p.removeClass("kv-single-content");if(a){h=d.addClass("file-thumb-loading").clone().insertAfter(d);d.html(o).hide();h.fadeOut("fast",function(){d.fadeIn("fast",function(){d.removeClass("file-thumb-loading")});h.remove()})}else{d.html(o)}c=r.previewZoomSettings[l];if(c){f=d.find(".kv-preview-data");i.addCss(f,"file-zoom-detail");e.each(c,function(e,i){f.css(e,i);if(f.attr("width")&&e==="width"||f.attr("height")&&e==="height"){f.removeAttr(e)}})}p.data("previewId",u);var x=d.find("img");if(x.length){i.adjustOrientedImage(x,true)}r._handler(m,"click",function(){r._zoomSlideShow("prev",u)});r._handler(g,"click",function(){r._zoomSlideShow("next",u)});r._handler(v,"click",function(){r._resizeZoomDialog(true)});r._handler(w,"click",function(){r._resizeZoomDialog(false)});r._handler(C,"click",function(){var e=p.find(".modal-header"),i=p.find(".modal-body .floating-buttons"),t,a=e.find(".kv-zoom-actions"),n=function(i){var t=r.$modal.find(".kv-zoom-body"),a=r.zoomModalHeight;if(p.hasClass("file-zoom-fullscreen")){a=t.outerHeight(true);if(!i){a=a-e.outerHeight(true)}}t.css("height",i?a+i:a)};if(e.is(":visible")){t=e.outerHeight(true);e.slideUp("slow",function(){a.find(".btn").appendTo(i);n(t)})}else{i.find(".btn").appendTo(a);e.slideDown("slow",function(){n()})}p.focus()});r._handler(p,"keydown",function(e){var i=e.which||e.keyCode;if(i===37&&!m.attr("disabled")){r._zoomSlideShow("prev",u)}if(i===39&&!g.attr("disabled")){r._zoomSlideShow("next",u)}})},_zoomPreview:function(e){var t=this,a,r=t.$modal;if(!e.length){throw"Cannot zoom to detailed preview!"}i.initModal(r);r.html(t._getModalContent());a=e.closest(i.FRAMES);t._setZoomContent(a);r.modal("show");t._initZoomButtons()},_zoomSlideShow:function(i,t){var a=this,r=a.$modal.find(".kv-zoom-actions .btn-"+i),n,l,o=a.getFrames().toArray(),s=o.length,d;if(r.attr("disabled")){return}for(l=0;l<s;l++){if(e(o[l]).attr("id")===t){d=i==="prev"?l-1:l+1;break}}if(d<0||d>=s||!o[d]){return}n=e(o[d]);if(n.length){a._setZoomContent(n,true)}a._initZoomButtons();a._raise("filezoom"+i,{previewId:t,modal:a.$modal})},_initZoomButton:function(){var i=this;i.$preview.find(".kv-file-zoom").each(function(){var t=e(this);i._handler(t,"click",function(){i._zoomPreview(t)})})},_clearObjects:function(i){i.find("video audio").each(function(){this.pause();e(this).remove()});i.find("img object div").each(function(){e(this).remove()})},_clearFileInput:function(){var t=this,a=t.$element,r,n,l;t.fileInputCleared=true;if(i.isEmpty(a.val())){return}if(t.isIE9||t.isIE10){r=a.closest("form");n=e(document.createElement("form"));l=e(document.createElement("div"));a.before(l);if(r.length){r.after(n)}else{l.after(n)}n.append(a).trigger("reset");l.before(a).remove();n.remove()}else{a.val("")}},_resetUpload:function(){var e=this;e.uploadCache={content:[],config:[],tags:[],append:true};e.uploadCount=0;e.uploadStatus={};e.uploadLog=[];e.uploadAsyncCount=0;e.loadedImages=[];e.totalImagesCount=0;e.$btnUpload.removeAttr("disabled");e._setProgress(0);e.$progress.hide();e._resetErrors(false);e.ajaxAborted=false;e.ajaxRequests=[];e._resetCanvas();e.cacheInitialPreview={};if(e.overwriteInitial){e.initialPreview=[];e.initialPreviewConfig=[];e.initialPreviewThumbTags=[];e.previewCache.data={content:[],config:[],tags:[]}}},_resetCanvas:function(){var e=this;if(e.canvas&&e.imageCanvasContext){e.imageCanvasContext.clearRect(0,0,e.canvas.width,e.canvas.height)}},_hasInitialPreview:function(){var e=this;return!e.overwriteInitial&&e.previewCache.count()},_resetPreview:function(){var e=this,i,t;if(e.previewCache.count()){i=e.previewCache.out();e._setPreviewContent(i.content);e._setInitThumbAttr();t=e.initialCaption?e.initialCaption:i.caption;e._setCaption(t)}else{e._clearPreview();e._initCaption()}if(e.showPreview){e._initZoom();e._initSortable()}},_clearDefaultPreview:function(){var e=this;e.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var e=this;if(!e.showPreview||i.isEmpty(e.defaultPreviewContent)){return}e._setPreviewContent('<div class="file-default-preview">'+e.defaultPreviewContent+"</div>");e.$container.removeClass("file-input-new");e._initClickable()},_resetPreviewThumbs:function(e){var i=this,t;if(e){i._clearPreview();i.clearStack();return}if(i._hasInitialPreview()){t=i.previewCache.out();i._setPreviewContent(t.content);i._setInitThumbAttr();i._setCaption(t.caption);i._initPreviewActions()}else{i._clearPreview()}},_getLayoutTemplate:function(e){var t=this,a=t.layoutTemplates[e];if(i.isEmpty(t.customLayoutTags)){return a}return i.replaceTags(a,t.customLayoutTags)},_getPreviewTemplate:function(e){var t=this,a=t.previewTemplates[e];if(i.isEmpty(t.customPreviewTags)){return a}return i.replaceTags(a,t.customPreviewTags)},_getOutData:function(e,i,t){var a=this;e=e||{};i=i||{};t=t||a.filestack.slice(0)||{};return{form:a.formdata,files:t,filenames:a.filenames,filescount:a.getFilesCount(),extra:a._getExtraData(),response:i,reader:a.reader,jqXHR:e}},_getMsgSelected:function(e){var i=this,t=e===1?i.fileSingle:i.filePlural;return e>0?i.msgSelected.replace("{n}",e).replace("{files}",t):i.msgNoFilesSelected},_getFrame:function(i){var t=this,a=e("#"+i);if(!a.length){t._log('Invalid thumb frame with id: "'+i+'".');return null}return a},_getThumbs:function(e){e=e||"";return this.getFrames(":not(.file-preview-initial)"+e)},_getExtraData:function(e,i){var t=this,a=t.uploadExtraData;if(typeof t.uploadExtraData==="function"){a=t.uploadExtraData(e,i)}return a},_initXhr:function(e,i,t){var a=this;if(e.upload){e.upload.addEventListener("progress",function(e){var r=0,n=e.total,l=e.loaded||e.position;if(e.lengthComputable){r=Math.floor(l/n*100)}if(i){a._setAsyncUploadStatus(i,r,t)}else{a._setProgress(r)}},false)}return e},_mergeAjaxCallback:function(e,i,t){var a=this,r=a.ajaxSettings,n=a.mergeAjaxCallbacks,l;if(t==="delete"){r=a.ajaxDeleteSettings;n=a.mergeAjaxDeleteCallbacks}l=r[e];if(n&&typeof l==="function"){if(n==="before"){r[e]=function(){l.apply(this,arguments);i.apply(this,arguments)}}else{r[e]=function(){i.apply(this,arguments);l.apply(this,arguments)}}}else{r[e]=i}if(t==="delete"){a.ajaxDeleteSettings=r}else{a.ajaxSettings=r}},_ajaxSubmit:function(i,t,a,r,n,l){var o=this,s;if(!o._raise("filepreajax",[n,l])){return}o._uploadExtra(n,l);o._mergeAjaxCallback("beforeSend",i);o._mergeAjaxCallback("success",t);o._mergeAjaxCallback("complete",a);o._mergeAjaxCallback("error",r);s=e.extend(true,{},{xhr:function(){var i=e.ajaxSettings.xhr();return o._initXhr(i,n,o.getFileStack().length)},url:l&&o.uploadUrlThumb?o.uploadUrlThumb:o.uploadUrl,type:"POST",dataType:"json",data:o.formdata,cache:false,processData:false,contentType:false},o.ajaxSettings);o.ajaxRequests.push(e.ajax(s))},_mergeArray:function(e,t){var a=this,r=i.cleanArray(a[e]),n=i.cleanArray(t);a[e]=r.concat(n)},_initUploadSuccess:function(t,a,r){var n=this,l,o,s,d,f,c,u,p,m;if(!n.showPreview||typeof t!=="object"||e.isEmptyObject(t)){return}if(t.initialPreview!==undefined&&t.initialPreview.length>0){n.hasInitData=true;c=t.initialPreview||[];u=t.initialPreviewConfig||[];p=t.initialPreviewThumbTags||[];l=t.append===undefined||t.append;if(c.length>0&&!i.isArray(c)){c=c.split(n.initialPreviewDelimiter)}n._mergeArray("initialPreview",c);n._mergeArray("initialPreviewConfig",u);n._mergeArray("initialPreviewThumbTags",p);if(a!==undefined){if(!r){s=n.previewCache.add(c,u[0],p[0],l);o=n.previewCache.get(s,false);d=e(document.createElement("div")).html(o).hide().insertAfter(a);f=d.find(".kv-zoom-cache");if(f&&f.length){f.insertAfter(a)}a.fadeOut("slow",function(){var e=d.find(".file-preview-frame");if(e&&e.length){e.insertBefore(a).fadeIn("slow").css("display:inline-block")}n._initPreviewActions();n._clearFileInput();i.cleanZoomCache(n.$preview.find("#zoom-"+a.attr("id")));a.remove();d.remove();n._initSortable()})}else{m=a.attr("data-fileindex");n.uploadCache.content[m]=c[0];n.uploadCache.config[m]=u[0]||[];n.uploadCache.tags[m]=p[0]||[];n.uploadCache.append=l}}else{n.previewCache.set(c,u,p,l);n._initPreview();n._initPreviewActions()}}},_initSuccessThumbs:function(){var t=this;if(!t.showPreview){return}t._getThumbs(i.FRAMES+".file-preview-success").each(function(){var a=e(this),r=t.$preview,n=a.find(".kv-file-remove");n.removeAttr("disabled");t._handler(n,"click",function(){var e=a.attr("id"),n=t._raise("filesuccessremove",[e,a.attr("data-fileindex")]);i.cleanMemory(a);if(n===false){return}a.fadeOut("slow",function(){i.cleanZoomCache(r.find("#zoom-"+e));a.remove();if(!t.getFrames().length){t.reset()}})})})},_checkAsyncComplete:function(){var i=this,t,a;for(a=0;a<i.filestack.length;a++){if(i.filestack[a]){t=i.previewInitId+"-"+a;if(e.inArray(t,i.uploadLog)===-1){return false}}}return i.uploadAsyncCount===i.uploadLog.length},_uploadExtra:function(i,t){var a=this,r=a._getExtraData(i,t);if(r.length===0){return}e.each(r,function(e,i){a.formdata.append(e,i)})},_uploadSingle:function(t,a){var r=this,n=r.getFileStack().length,l=new FormData,o,s=r.previewInitId+"-"+t,d,f,c,u,p=r.filestack.length>0||!e.isEmptyObject(r.uploadExtraData),m,g=e("#"+s).find(".file-thumb-progress"),h,v,w,_,b,C={id:s,index:t};r.formdata=l;if(r.showPreview){d=e("#"+s+":not(.file-preview-initial)");c=d.find(".kv-file-upload");u=d.find(".kv-file-remove");g.show()}if(n===0||!p||c&&c.hasClass("disabled")||r._abort(C)){return}b=function(e,i){if(!m){r.updateStack(e,undefined)}r.uploadLog.push(i);if(r._checkAsyncComplete()){r.fileBatchCompleted=true}};f=function(){var e=r.uploadCache,t,a,n,l=0,o=r.cacheInitialPreview;if(!r.fileBatchCompleted){return}if(o&&o.content){l=o.content.length}setTimeout(function(){var s=r.getFileStack(true).length===0;if(r.showPreview){r.previewCache.set(e.content,e.config,e.tags,e.append);if(l){for(a=0;a<e.content.length;a++){n=a+l;o.content[n]=e.content[a];if(o.config.length){o.config[n]=e.config[a]}if(o.tags.length){o.tags[n]=e.tags[a]}}r.initialPreview=i.cleanArray(o.content);r.initialPreviewConfig=i.cleanArray(o.config);r.initialPreviewThumbTags=i.cleanArray(o.tags)}else{r.initialPreview=e.content;r.initialPreviewConfig=e.config;r.initialPreviewThumbTags=e.tags}r.cacheInitialPreview={};if(r.hasInitData){r._initPreview();r._initPreviewActions()}}r.unlock(s);if(s){r._clearFileInput()}t=r.$preview.find(".file-preview-initial");if(r.uploadAsync&&t.length){i.addCss(t,i.SORT_CSS);r._initSortable()}r._raise("filebatchuploadcomplete",[r.filestack,r._getExtraData()]);r.uploadCount=0;r.uploadStatus={};r.uploadLog=[];r._setProgress(101)},100)};h=function(n){o=r._getOutData(n);r.fileBatchCompleted=false;if(r.showPreview){if(!d.hasClass("file-preview-success")){r._setThumbStatus(d,"Loading");i.addCss(d,"file-uploading")}c.attr("disabled",true);u.attr("disabled",true)}if(!a){r.lock()}r._raise("filepreupload",[o,s,t]);e.extend(true,C,o);if(r._abort(C)){n.abort();r._setProgressCancelled()}};v=function(n,l,f){var u=r.showPreview&&d.attr("id")?d.attr("id"):s;o=r._getOutData(f,n);e.extend(true,C,o);setTimeout(function(){if(i.isEmpty(n)||i.isEmpty(n.error)){if(r.showPreview){r._setThumbStatus(d,"Success");c.hide();r._initUploadSuccess(n,d,a);r._setProgress(101,g)}r._raise("fileuploaded",[o,u,t]);if(!a){r.updateStack(t,undefined)}else{b(t,u)}}else{m=true;r._showUploadError(n.error,C);r._setPreviewError(d,t,r.filestack[t],r.retryErrorUploads);if(!r.retryErrorUploads){c.hide()}if(a){b(t,u)}r._setProgress(101,e("#"+u).find(".file-thumb-progress"),r.msgUploadError)}},100)};w=function(){setTimeout(function(){if(r.showPreview){c.removeAttr("disabled");u.removeAttr("disabled");d.removeClass("file-uploading")}if(!a){r.unlock(false);r._clearFileInput()}else{f()}r._initSuccessThumbs()},100)};_=function(i,n,l){var o=r.ajaxOperations.uploadThumb,f=r._parseError(o,i,l,a&&r.filestack[t].name?r.filestack[t].name:null);m=true;setTimeout(function(){if(a){b(t,s)}r.uploadStatus[s]=100;r._setPreviewError(d,t,r.filestack[t],r.retryErrorUploads);if(!r.retryErrorUploads){c.hide()}e.extend(true,C,r._getOutData(i));r._setProgress(101,g,r.msgAjaxProgressError.replace("{operation}",o));r._setProgress(101,e("#"+s).find(".file-thumb-progress"),r.msgUploadError);r._showUploadError(f,C)},100)};l.append(r.uploadFileAttr,r.filestack[t],r.filenames[t]);l.append("file_id",t);r._ajaxSubmit(h,v,w,_,s,t)},_uploadBatch:function(){var t=this,a=t.filestack,r=a.length,n={},l,o,s,d,f=t.filestack.length>0||!e.isEmptyObject(t.uploadExtraData),c;t.formdata=new FormData;if(r===0||!f||t._abort(n)){return}c=function(){e.each(a,function(e){t.updateStack(e,undefined)});t._clearFileInput()};l=function(a){t.lock();var r=t._getOutData(a);if(t.showPreview){t._getThumbs().each(function(){var a=e(this),r=a.find(".kv-file-upload"),n=a.find(".kv-file-remove");if(!a.hasClass("file-preview-success")){t._setThumbStatus(a,"Loading");i.addCss(a,"file-uploading")}r.attr("disabled",true);n.attr("disabled",true)})}t._raise("filebatchpreupload",[r]);if(t._abort(r)){a.abort();t._setProgressCancelled()}};o=function(a,r,n){var l=t._getOutData(n,a),o=0,s=t._getThumbs(":not(.file-preview-success)"),d=i.isEmpty(a)||i.isEmpty(a.errorkeys)?[]:a.errorkeys;if(i.isEmpty(a)||i.isEmpty(a.error)){t._raise("filebatchuploadsuccess",[l]);c();if(t.showPreview){s.each(function(){var i=e(this);t._setThumbStatus(i,"Success");i.removeClass("file-uploading");i.find(".kv-file-upload").hide().removeAttr("disabled")});t._initUploadSuccess(a)}else{t.reset()}t._setProgress(101)}else{if(t.showPreview){s.each(function(){var i=e(this),a=i.attr("data-fileindex");i.removeClass("file-uploading");i.find(".kv-file-upload").removeAttr("disabled");i.find(".kv-file-remove").removeAttr("disabled");if(d.length===0||e.inArray(o,d)!==-1){t._setPreviewError(i,a,t.filestack[a],t.retryErrorUploads);if(!t.retryErrorUploads){i.find(".kv-file-upload").hide();t.updateStack(a,undefined)}}else{i.find(".kv-file-upload").hide();t._setThumbStatus(i,"Success");t.updateStack(a,undefined)}if(!i.hasClass("file-preview-error")||t.retryErrorUploads){o++}});t._initUploadSuccess(a)}t._showUploadError(a.error,l,"filebatchuploaderror");t._setProgress(101,t.$progress,t.msgUploadError)}};d=function(){t.unlock();t._initSuccessThumbs();t._clearFileInput();t._raise("filebatchuploadcomplete",[t.filestack,t._getExtraData()])};s=function(i,a,n){var l=t._getOutData(i),o=t.ajaxOperations.uploadBatch,s=t._parseError(o,i,n);t._showUploadError(s,l,"filebatchuploaderror");t.uploadFileCount=r-1;if(!t.showPreview){return}t._getThumbs().each(function(){var i=e(this),a=i.attr("data-fileindex");i.removeClass("file-uploading");if(t.filestack[a]!==undefined){t._setPreviewError(i)}});t._getThumbs().removeClass("file-uploading");t._getThumbs(" .kv-file-upload").removeAttr("disabled");t._getThumbs(" .kv-file-delete").removeAttr("disabled");t._setProgress(101,t.$progress,t.msgAjaxProgressError.replace("{operation}",o))};e.each(a,function(e,r){if(!i.isEmpty(a[e])){t.formdata.append(t.uploadFileAttr,r,t.filenames[e])}});t._ajaxSubmit(l,o,d,s)},_uploadExtraOnly:function(){var e=this,t={},a,r,n,l;e.formdata=new FormData;if(e._abort(t)){return}a=function(i){e.lock();var a=e._getOutData(i);e._raise("filebatchpreupload",[a]);e._setProgress(50);t.data=a;t.xhr=i;if(e._abort(t)){i.abort();e._setProgressCancelled()}};r=function(t,a,r){var n=e._getOutData(r,t);if(i.isEmpty(t)||i.isEmpty(t.error)){e._raise("filebatchuploadsuccess",[n]);e._clearFileInput();e._initUploadSuccess(t);e._setProgress(101)}else{e._showUploadError(t.error,n,"filebatchuploaderror")}};n=function(){e.unlock();e._clearFileInput();e._raise("filebatchuploadcomplete",[e.filestack,e._getExtraData()])};l=function(i,a,r){var n=e._getOutData(i),l=e.ajaxOperations.uploadExtra,o=e._parseError(l,i,r);t.data=n;e._showUploadError(o,n,"filebatchuploaderror");e._setProgress(101,e.$progress,e.msgAjaxProgressError.replace("{operation}",l))};e._ajaxSubmit(a,r,n,l)},_deleteFileIndex:function(t){var a=this,r=t.attr("data-fileindex");if(r.substring(0,5)==="init_"){r=parseInt(r.replace("init_",""));a.initialPreview=i.spliceArray(a.initialPreview,r);a.initialPreviewConfig=i.spliceArray(a.initialPreviewConfig,r);a.initialPreviewThumbTags=i.spliceArray(a.initialPreviewThumbTags,r);a.getFrames().each(function(){var i=e(this),t=i.attr("data-fileindex");if(t.substring(0,5)==="init_"){t=parseInt(t.replace("init_",""));if(t>r){t--;i.attr("data-fileindex","init_"+t)}}});if(a.uploadAsync){a.cacheInitialPreview=a.getPreview()}}},_initFileActions:function(){var t=this,a=t.$preview;if(!t.showPreview){return}t._initZoomButton();t.getFrames(" .kv-file-remove").each(function(){var r=e(this),n=r.closest(i.FRAMES),l,o=n.attr("id"),s=n.attr("data-fileindex"),d,f,c;t._handler(r,"click",function(){c=t._raise("filepreremove",[o,s]);if(c===false||!t._validateMinCount()){return false}l=n.hasClass("file-preview-error");i.cleanMemory(n);n.fadeOut("slow",function(){i.cleanZoomCache(a.find("#zoom-"+o));t.updateStack(s,undefined);t._clearObjects(n);n.remove();if(o&&l){t.$errorContainer.find('li[data-file-id="'+o+'"]').fadeOut("fast",function(){e(this).remove();if(!t._errorsExist()){t._resetErrors()}})}t._clearFileInput();var r=t.getFileStack(true),c=t.previewCache.count(),u=r.length,p=t.showPreview&&t.getFrames().length;if(u===0&&c===0&&!p){t.reset()}else{d=c+u;f=d>1?t._getMsgSelected(d):r[0]?t._getFileNames()[0]:"";t._setCaption(f)}t._raise("fileremoved",[o,s])})})});t.getFrames(" .kv-file-upload").each(function(){var a=e(this);t._handler(a,"click",function(){var e=a.closest(i.FRAMES),r=e.attr("data-fileindex");t.$progress.hide();if(e.hasClass("file-preview-error")&&!t.retryErrorUploads){return}t._uploadSingle(r,false)})})},_initPreviewActions:function(){var t=this,a=t.$preview,r=t.deleteExtraData||{},n=i.FRAMES+" .kv-file-remove",l=t.fileActionSettings,o=l.removeClass,s=l.removeErrorClass,d=function(){var e=t.isUploadable?t.previewCache.count():t.$element.get(0).files.length;if(!a.find(i.FRAMES).length&&!e){t._setCaption("");t.reset();t.initialCaption=""}};t._initZoomButton();a.find(n).each(function(){var n=e(this),l=n.data("url")||t.deleteUrl,f=n.data("key"),c,u,p,m=n.closest(".file-preview-frame");if(i.isEmpty(l)||f===undefined){return}var g=n.closest(i.FRAMES),h=t.previewCache.data,v,w,_=g.attr("data-fileindex"),b,C;_=parseInt(_.replace("init_",""));b=i.isEmpty(h.config)&&i.isEmpty(h.config[_])?null:h.config[_];C=i.isEmpty(b)||i.isEmpty(b.extra)?r:b.extra;if(typeof C==="function"){C=C()}w={id:n.attr("id"),key:f,extra:C};c=function(e){t.ajaxAborted=false;t._raise("filepredelete",[f,e,C]);n.removeClass(s);if(t._abort()){e.abort()}else{i.addCss(g,"file-uploading");i.addCss(n,"disabled "+o)}};u=function(e,r,l){var c,u;if(!i.isEmpty(e)&&!i.isEmpty(e.error)){w.jqXHR=l;w.response=e;t._showError(e.error,w,"filedeleteerror");g.removeClass("file-uploading");n.removeClass("disabled "+o).addClass(s);d();return}g.removeClass("file-uploading").addClass("file-deleted");g.fadeOut("slow",function(){_=parseInt(g.attr("data-fileindex").replace("init_",""));t.previewCache.unset(_);c=t.previewCache.count();u=c>0?t._getMsgSelected(c):"";t._deleteFileIndex(g);t._setCaption(u);t._raise("filedeleted",[f,l,C]);i.cleanZoomCache(a.find("#zoom-"+g.attr("id")));t._clearObjects(g);g.remove();d()})};p=function(e,i,a){var r=t.ajaxOperations.deleteThumb,l=t._parseError(r,e,a);w.jqXHR=e;w.response={};t._showError(l,w,"filedeleteerror");g.removeClass("file-uploading");n.removeClass("disabled "+o).addClass(s);d()};t._mergeAjaxCallback("beforeSend",c,"delete");t._mergeAjaxCallback("success",u,"delete");t._mergeAjaxCallback("error",p,"delete");v=e.extend(true,{},{url:l,type:"POST",dataType:"json",data:e.extend(true,{},{key:f},C)},t.ajaxDeleteSettings);t._handler(n,"click",function(){if(!t._validateMinCount()){return false}t.ajaxAborted=false;t._raise("filebeforedelete",[f,C]);if(t.ajaxAborted instanceof Promise){t.ajaxAborted.then(function(i){if(!i){e.ajax(v)}})}else{if(!t.ajaxAborted){e.ajax(v)}}})})},_hideFileIcon:function(){if(this.overwriteInitial){this.$captionContainer.find(".kv-caption-icon").hide()}},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(i){var t=this,a=parseFloat(i),r,n=t.fileSizeGetter,l,o;if(!e.isNumeric(i)||!e.isNumeric(a)){return""}if(typeof n==="function"){o=n(a)}else{if(a===0){o="0.00 B"}else{r=Math.floor(Math.log(a)/Math.log(1024));l=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];o=(a/Math.pow(1024,r)).toFixed(2)*1+" "+l[r]}}return t._getLayoutTemplate("size").replace("{sizeText}",o)},_generatePreviewTemplate:function(t,a,r,n,l,o,s,d,f,c,u){var p=this,m=p.slug(r),g,h="",v="",w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,_=w<400?p.previewSettingsSmall[t]||p.defaults.previewSettingsSmall[t]:p.previewSettings[t]||p.defaults.previewSettings[t],b=f||p._renderFileFooter(m,s,"auto",o),C=p._getPreviewIcon(r),y="type-default",x=C&&p.preferIconicPreview,E=C&&p.preferIconicZoomPreview,T;if(_){e.each(_,function(e,i){v+=e+":"+i+";"})}T=function(a,o,s,f){var g=s?"zoom-"+l:l,h=p._getPreviewTemplate(a),w=(d||"")+" "+f;if(p.frameClass){w=p.frameClass+" "+w}if(s){w=w.replace(" "+i.SORT_CSS,"")}h=p._parseFilePreviewIcon(h,r);if(a==="text"){o=i.htmlEncode(o)}if(t==="object"&&!n){e.each(p.defaults.fileTypeSettings,function(e,i){if(e==="object"||e==="other"){return}if(i(r,n)){y="type-"+e}})}return h.setTokens({previewId:g,caption:m,frameClass:w,type:n,fileindex:c,typeCss:y,footer:b,data:o,template:u||t,style:v?'style="'+v+'"':""})};c=c||l.slice(l.lastIndexOf("-")+1);if(p.fileActionSettings.showZoom){h=T(E?"other":t,a,true,"kv-zoom-thumb")}h="\n"+p._getLayoutTemplate("zoomCache").replace("{zoomContent}",h);g=T(x?"other":t,a,false,"kv-preview-thumb");return g+h},_previewDefault:function(t,a,r){var n=this,l=n.$preview;if(!n.showPreview){return}var o=t?t.name:"",s=t?t.type:"",d,f=t.size||0,c=n.slug(o),u=r===true&&!n.isUploadable,p=i.objUrl.createObjectURL(t);n._clearDefaultPreview();d=n._generatePreviewTemplate("other",p,o,s,a,u,f);l.append("\n"+d);n._setThumbAttr(a,c,f);if(r===true&&n.isUploadable){n._setThumbStatus(e("#"+a),"Error")}},_previewFile:function(e,t,a,r,n){if(!this.showPreview){return}var l=this,o=l._parseFileType(t),s=t?t.name:"",d=l.slug(s),f=l.allowedPreviewTypes,c=l.allowedPreviewMimeTypes,u=l.$preview,p=f&&f.indexOf(o)>=0,m=t.size||0,g=t.type,h=o==="text"||o==="html"||o==="image"?a.target.result:n,v,w=c&&c.indexOf(g)!==-1;if(o==="html"&&l.purifyHtml&&window.DOMPurify){h=window.DOMPurify.sanitize(h)}if(p||w){v=l._generatePreviewTemplate(o,h,s,g,r,false,m);l._clearDefaultPreview();u.append("\n"+v);var _=u.find("#"+r+" img");if(_.length&&l.autoOrientImage){i.validateOrientation(t,function(e){if(!e){l._validateImage(r,d,g,m,h);return}var a=u.find("#zoom-"+r+" img"),n="rotate-"+e;if(e>4){n+=_.width()>_.height()?" is-portrait-gt4":" is-landscape-gt4"}i.addCss(_,n);i.addCss(a,n);l._raise("fileimageoriented",{$img:_,file:t});l._validateImage(r,d,g,m,h);i.adjustOrientedImage(_)})}else{l._validateImage(r,d,g,m,h)}}else{l._previewDefault(t,r)}l._setThumbAttr(r,d,m);l._initSortable()},_setThumbAttr:function(i,t,a){var r=this,n=e("#"+i);if(n.length){a=a&&a>0?r._getSize(a):"";n.data({caption:t,size:a})}},_setInitThumbAttr:function(){var e=this,t=e.previewCache.data,a=e.previewCache.count(),r,n,l,o;if(a===0){return}for(var s=0;s<a;s++){r=t.config[s];o=e.previewInitId+"-"+"init_"+s;n=i.ifSet("caption",r,i.ifSet("filename",r));l=i.ifSet("size",r);e._setThumbAttr(o,n,l)}},_slugDefault:function(e){return i.isEmpty(e)?"":String(e).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(t){this.reader=new FileReader;var a=this,r=a.$element,n=a.$preview,l=a.reader,o=a.$previewContainer,s=a.$previewStatus,d=a.msgLoading,f=a.msgProgress,c=a.previewInitId,u=t.length,p=a.fileTypeSettings,m=a.filestack.length,g,h=a.allowedFileTypes,v=h?h.length:0,w=a.allowedFileExtensions,_=i.isEmpty(w)?"":w.join(", "),b=a.maxFilePreviewSize&&parseFloat(a.maxFilePreviewSize),C=n.length&&(!b||isNaN(b)),y=function(i,r,n,l){var o=e.extend(true,{},a._getOutData({},{},t),{id:n,index:l}),s={id:n,index:l,file:r,files:t},d;a._previewDefault(r,n,true);if(a.isUploadable){a.addToStack(undefined);setTimeout(function(){g(l+1)},100)}a._initFileActions();d=e("#"+n);d.find(".kv-file-upload").hide();if(a.removeFromPreviewOnError){d.remove()}return a.isUploadable?a._showUploadError(i,o):a._showError(i,s)};a.loadedImages=[];a.totalImagesCount=0;e.each(t,function(e,i){var t=a.fileTypeSettings.image;if(t&&t(i.type)){a.totalImagesCount++}});g=function(e){if(i.isEmpty(r.attr("multiple"))){u=1}if(e>=u){if(a.isUploadable&&a.filestack.length>0){a._raise("filebatchselected",[a.getFileStack()])}else{a._raise("filebatchselected",[t])}o.removeClass("file-thumb-loading");s.html("");return}var x=m+e,E=c+"-"+x,T,S,F=t[e],k,I=F.name?a.slug(F.name):"",P=(F.size||0)/1e3,A,z,D="",$=i.objUrl.createObjectURL(F),U,j,B,R,O=0,L="",Z;if(v>0){for(A=0;A<v;A++){B=h[A];R=a.msgFileTypes[B]||B;L+=A===0?R:", "+R}}if(I===false){g(e+1);return}if(I.length===0){z=a.msgInvalidFileName.replace("{name}",i.htmlEncode(F.name));a.isError=y(z,F,E,e);return}if(!i.isEmpty(w)){D=new RegExp("\\.("+w.join("|")+")$","i")}k=P.toFixed(2);if(a.maxFileSize>0&&P>a.maxFileSize){z=a.msgSizeTooLarge.setTokens({name:I,size:k,maxSize:a.maxFileSize});a.isError=y(z,F,E,e);return}if(a.minFileSize!==null&&P<=i.getNum(a.minFileSize)){z=a.msgSizeTooSmall.setTokens({name:I,size:k,minSize:a.minFileSize});a.isError=y(z,F,E,e);return}if(!i.isEmpty(h)&&i.isArray(h)){for(A=0;A<h.length;A+=1){U=h[A];Z=p[U];O+=!Z||typeof Z!=="function"?0:Z(F.type,F.name)?1:0}if(O===0){z=a.msgInvalidFileType.setTokens({name:I,types:L});a.isError=y(z,F,E,e);return}}if(O===0&&!i.isEmpty(w)&&i.isArray(w)&&!i.isEmpty(D)){j=i.compare(I,D);O+=i.isEmpty(j)?0:j.length;if(O===0){z=a.msgInvalidFileExtension.setTokens({name:I,extensions:_});a.isError=y(z,F,E,e);return}}if(!a.showPreview){if(a.isUploadable){a.addToStack(F)}setTimeout(function(){g(e+1);a._updateFileDetails(u)},100);a._raise("fileloaded",[F,E,e,l]);return}if(!C&&P>b){a.addToStack(F);o.addClass("file-thumb-loading");a._previewDefault(F,E);a._initFileActions();a._updateFileDetails(u);g(e+1);return}if(n.length&&FileReader!==undefined){s.html(d.replace("{index}",e+1).replace("{files}",u));o.addClass("file-thumb-loading");l.onerror=function(e){a._errorHandler(e,I)};l.onload=function(i){a._previewFile(e,F,i,E,$);a._initFileActions()};l.onloadend=function(){z=f.setTokens({index:e+1,files:u,percent:50,name:I});setTimeout(function(){s.html(z);a._updateFileDetails(u);g(e+1)},100);a._raise("fileloaded",[F,E,e,l])};l.onprogress=function(i){if(i.lengthComputable){var t=i.loaded/i.total*100,a=Math.ceil(t);z=f.setTokens({index:e+1,files:u,percent:a,name:I});setTimeout(function(){s.html(z)},100)}};T=p.text;S=p.image;if(T(F.type,I)){l.readAsText(F,a.textEncoding)}else{if(S(F.type,I)){l.readAsDataURL(F)}else{l.readAsArrayBuffer(F)}}}else{a._previewDefault(F,E);setTimeout(function(){g(e+1);a._updateFileDetails(u)},100);a._raise("fileloaded",[F,E,e,l])}a.addToStack(F)};g(0);a._updateFileDetails(u,false)},_updateFileDetails:function(e){var t=this,a=t.$element,r=t.getFileStack(),n=i.isIE(9)&&i.findFileName(a.val())||a[0].files[0]&&a[0].files[0].name||r.length&&r[0].name||"",l=t.slug(n),o=t.isUploadable?r.length:e,s=t.previewCache.count()+o,d=o>1?t._getMsgSelected(s):l;if(t.isError){t.$previewContainer.removeClass("file-thumb-loading");t.$previewStatus.html("");t.$captionContainer.find(".kv-caption-icon").hide()}else{t._showFileIcon()}t._setCaption(d,t.isError);t.$container.removeClass("file-input-new file-input-ajax-new");if(arguments.length===1){t._raise("fileselect",[e,l])}if(t.previewCache.count()){t._initPreviewActions()}},_setThumbStatus:function(e,i){var t=this;if(!t.showPreview){return}var a="indicator"+i,r=a+"Title",n="file-preview-"+i.toLowerCase(),l=e.find(".file-upload-indicator"),o=t.fileActionSettings;e.removeClass("file-preview-success file-preview-error file-preview-loading");if(i==="Success"){e.find(".file-drag-handle").remove()}l.html(o[a]);l.attr("title",o[r]);e.addClass(n);if(i==="Error"&&!t.retryErrorUploads){e.find(".kv-file-upload").attr("disabled",true)}},_setProgressCancelled:function(){var e=this;e._setProgress(101,e.$progress,e.msgCancelled)},_setProgress:function(e,t,a){var r=this,n=Math.min(e,100),l,o=r.progressUploadThreshold,s=e<=100?r.progressTemplate:r.progressCompleteTemplate,d=n<100?r.progressTemplate:a?r.progressErrorTemplate:s;t=t||r.$progress;if(!i.isEmpty(d)){if(o&&n>o&&e<=100){l=d.setTokens({percent:o,status:r.msgUploadThreshold})}else{l=d.setTokens({percent:n,status:e>100?r.msgUploadEnd:n+"%"})}t.html(l);if(a){t.find('[role="progressbar"]').html(a);
}}},_setFileDropZoneTitle:function(){var e=this,t=e.$container.find(".file-drop-zone"),a=e.dropZoneTitle,r;if(e.isClickable){r=i.isEmpty(e.$element.attr("multiple"))?e.fileSingle:e.filePlural;a+=e.dropZoneClickTitle.replace("{files}",r)}t.find("."+e.dropZoneTitleClass).remove();if(!e.isUploadable||!e.showPreview||t.length===0||e.getFileStack().length>0||!e.dropZoneEnabled){return}if(t.find(i.FRAMES).length===0&&i.isEmpty(e.defaultPreviewContent)){t.prepend('<div class="'+e.dropZoneTitleClass+'">'+a+"</div>")}e.$container.removeClass("file-input-new");i.addCss(e.$container,"file-input-ajax-new")},_setAsyncUploadStatus:function(i,t,a){var r=this,n=0;r._setProgress(t,e("#"+i).find(".file-thumb-progress"));r.uploadStatus[i]=t;e.each(r.uploadStatus,function(e,i){n+=i});r._setProgress(Math.floor(n/a))},_validateMinCount:function(){var e=this,i=e.isUploadable?e.getFileStack().length:e.$element.get(0).files.length;if(e.validateInitialCount&&e.minFileCount>0&&e._getFileCount(i-1)<e.minFileCount){e._noFilesError({});return false}return true},_getFileCount:function(e){var i=this,t=0;if(i.validateInitialCount&&!i.overwriteInitial){t=i.previewCache.count();e+=t}return e},_getFileId:function(e){var i=this,t=i.generateFileId,a;if(typeof t==="function"){return t(e,event)}if(!e){return null}a=String(e.webkitRelativePath||e.fileName||e.name||null);if(!a){return null}return e.size+"-"+a.replace(/[^0-9a-zA-Z_-]/gim,"")},_getFileName:function(e){return e&&e.name?this.slug(e.name):undefined},_getFileIds:function(e){var i=this;return i.fileids.filter(function(i){return e?i!==undefined:i!==undefined&&i!==null})},_getFileNames:function(e){var i=this;return i.filenames.filter(function(i){return e?i!==undefined:i!==undefined&&i!==null})},_setPreviewError:function(e,i,t,a){var r=this;if(i!==undefined){r.updateStack(i,t)}if(r.removeFromPreviewOnError&&!a){e.remove();return}else{r._setThumbStatus(e,"Error")}r._refreshUploadButton(e,a)},_refreshUploadButton:function(e,i){var t=this,a=e.find(".kv-file-upload"),r=t.fileActionSettings,n=r.uploadIcon,l=r.uploadTitle;if(!a.length){return}if(i){n=r.uploadRetryIcon;l=r.uploadRetryTitle}a.attr("title",l).html(n)},_checkDimensions:function(e,t,a,r,n,l,o){var s=this,d,f,c=t==="Small"?"min":"max",u=s[c+"Image"+l],p,m;if(i.isEmpty(u)||!a.length){return}p=a[0];f=l==="Width"?p.naturalWidth||p.width:p.naturalHeight||p.height;m=t==="Small"?f>=u:f<=u;if(m){return}d=s["msgImage"+l+t].setTokens({name:n,size:u});s._showUploadError(d,o);s._setPreviewError(r,e,null)},_validateImage:function(i,t,a,r,n){var l=this,o=l.$preview,s,d,f,c=o.find("#"+i),u=c.attr("data-fileindex"),p=c.find("img"),m;t=t||"Untitled";p.one("load",function(){d=c.width();f=o.width();if(d>f){p.css("width","100%")}s={ind:u,id:i};l._checkDimensions(u,"Small",p,c,t,"Width",s);l._checkDimensions(u,"Small",p,c,t,"Height",s);if(!l.resizeImage){l._checkDimensions(u,"Large",p,c,t,"Width",s);l._checkDimensions(u,"Large",p,c,t,"Height",s)}l._raise("fileimageloaded",[i]);m=window.piexif?window.piexif.load(n):null;l.loadedImages.push({ind:u,img:p,thumb:c,pid:i,typ:a,siz:r,validated:false,imgData:n,exifObj:m});c.data("exif",m);l._validateAllImages()}).one("error",function(){l._raise("fileimageloaderror",[i])}).each(function(){if(this.complete){e(this).trigger("load")}else{if(this.error){e(this).trigger("error")}}})},_validateAllImages:function(){var e=this,i,t={val:0},a=e.loadedImages.length,r,n,l=e.resizeIfSizeMoreThan;if(a!==e.totalImagesCount){return}e._raise("fileimagesloaded");if(!e.resizeImage){return}for(i=0;i<e.loadedImages.length;i++){r=e.loadedImages[i];if(r.validated){continue}n=r.siz;if(n&&n>l*1e3){e._getResizedImage(r,t,a)}e.loadedImages[i].validated=true}},_getResizedImage:function(t,a,r){var n=this,l=e(t.img)[0],o=l.naturalWidth,s=l.naturalHeight,d,f=1,c=n.maxImageWidth||o,u=n.maxImageHeight||s,p=!!(o&&s),m,g,h=n.imageCanvas,v,w=n.imageCanvasContext,_=t.typ,b=t.pid,C=t.ind,y=t.thumb,x,E,T=t.exifObj,S;x=function(e,i,t){if(n.isUploadable){n._showUploadError(e,i,t)}else{n._showError(e,i,t)}n._setPreviewError(y,C)};if(!n.filestack[C]||!p||o<=c&&s<=u){if(p&&n.filestack[C]){n._raise("fileimageresized",[b,C])}a.val++;if(a.val===r){n._raise("fileimagesresized")}if(!p){x(n.msgImageResizeError,{id:b,index:C},"fileimageresizeerror");return}}_=_||n.resizeDefaultImageType;m=o>c;g=s>u;if(n.resizePreference==="width"){f=m?c/o:g?u/s:1}else{f=g?u/s:m?c/o:1}n._resetCanvas();o*=f;s*=f;h.width=o;h.height=s;try{w.drawImage(l,0,0,o,s);v=h.toDataURL(_,n.resizeQuality);if(T){S=window.piexif.dump(T);v=window.piexif.insert(S,v)}d=i.dataURI2Blob(v);n.filestack[C]=d;n._raise("fileimageresized",[b,C]);a.val++;if(a.val===r){n._raise("fileimagesresized",[undefined,undefined])}if(!(d instanceof Blob)){x(n.msgImageResizeError,{id:b,index:C},"fileimageresizeerror")}}catch(e){a.val++;if(a.val===r){n._raise("fileimagesresized",[undefined,undefined])}E=n.msgImageResizeException.replace("{errors}",e.message);x(E,{id:b,index:C},"fileimageresizeexception")}},_initBrowse:function(e){var i=this;if(i.showBrowse){i.$btnFile=e.find(".btn-file");i.$btnFile.append(i.$element)}else{i.$element.hide()}},_initCaption:function(){var e=this,t=e.initialCaption||"";if(e.overwriteInitial||i.isEmpty(t)){e.$caption.html("");return false}e._setCaption(t);return true},_setCaption:function(t,a){var r=this,n,l,o,s,d=r.getFileStack();if(!r.$caption.length){return}if(a){n=e("<div>"+r.msgValidationError+"</div>").text();o=d.length;if(o){s=o===1&&d[0]?r._getFileNames()[0]:r._getMsgSelected(o)}else{s=r._getMsgSelected(r.msgNo)}l='<span class="'+r.msgValidationErrorClass+'">'+r.msgValidationErrorIcon+(i.isEmpty(t)?s:t)+"</span>"}else{if(i.isEmpty(t)){return}n=e("<div>"+t+"</div>").text();l=r._getLayoutTemplate("fileIcon")+n}r.$caption.html(l);r.$caption.attr("title",n);r.$captionContainer.find(".file-caption-ellipsis").attr("title",n)},_createContainer:function(){var i=this,t={class:"file-input file-input-new"+(i.rtl?" kv-rtl":"")},a=e(document.createElement("div")).attr(t).html(i._renderMain());i.$element.before(a);i._initBrowse(a);if(i.theme){a.addClass("theme-"+i.theme)}return a},_refreshContainer:function(){var e=this,i=e.$container;i.before(e.$element);i.html(e._renderMain());e._initBrowse(i)},_renderMain:function(){var e=this,i=e.isUploadable&&e.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",t=!e.showClose?"":e._getLayoutTemplate("close"),a=!e.showPreview?"":e._getLayoutTemplate("preview").setTokens({class:e.previewClass,dropClass:i}),r=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,n=e.captionTemplate.setTokens({class:r+" kv-fileinput-caption"});return e.mainTemplate.setTokens({class:e.mainClass+(!e.showBrowse&&e.showCaption?" no-browse":""),preview:a,close:t,caption:n,upload:e._renderButton("upload"),remove:e._renderButton("remove"),cancel:e._renderButton("cancel"),browse:e._renderButton("browse")})},_renderButton:function(e){var t=this,a=t._getLayoutTemplate("btnDefault"),r=t[e+"Class"],n=t[e+"Title"],l=t[e+"Icon"],o=t[e+"Label"],s=t.isDisabled?" disabled":"",d="button";switch(e){case"remove":if(!t.showRemove){return""}break;case"cancel":if(!t.showCancel){return""}r+=" kv-hidden";break;case"upload":if(!t.showUpload){return""}if(t.isUploadable&&!t.isDisabled){a=t._getLayoutTemplate("btnLink").replace("{href}",t.uploadUrl)}else{d="submit"}break;case"browse":if(!t.showBrowse){return""}a=t._getLayoutTemplate("btnBrowse");break;default:return""}r+=e==="browse"?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button";if(!i.isEmpty(o)){o=' <span class="'+t.buttonLabelClass+'">'+o+"</span>"}return a.setTokens({type:d,css:r,title:n,status:s,icon:l,label:o})},_renderThumbProgress:function(){var e=this;return'<div class="file-thumb-progress kv-hidden">'+e.progressTemplate.setTokens({percent:"0",status:e.msgUploadBegin})+"</div>"},_renderFileFooter:function(e,t,a,r){var n=this,l=n.fileActionSettings,o=l.showRemove,s=l.showDrag,d=l.showUpload,f=l.showZoom,c,u=n._getLayoutTemplate("footer"),p=n._getLayoutTemplate("indicator"),m=r?l.indicatorError:l.indicatorNew,g=r?l.indicatorErrorTitle:l.indicatorNewTitle,h=p.setTokens({indicator:m,indicatorTitle:g});t=n._getSize(t);if(n.isUploadable){c=u.setTokens({actions:n._renderFileActions(d,false,o,f,s,false,false,false),caption:e,size:t,width:a,progress:n._renderThumbProgress(),indicator:h})}else{c=u.setTokens({actions:n._renderFileActions(false,false,false,f,s,false,false,false),caption:e,size:t,width:a,progress:"",indicator:h})}c=i.replaceTags(c,n.previewThumbTags);return c},_renderFileActions:function(e,i,t,a,r,n,l,o,s,d,f){if(!e&&!i&&!t&&!a&&!r){return""}var c=this,u=l===false?"":' data-url="'+l+'"',p=o===false?"":' data-key="'+o+'"',m="",g="",h="",v="",w="",_,b=c._getLayoutTemplate("actions"),C=c.fileActionSettings,y=c.otherActionButtons.setTokens({dataKey:p,key:o}),x=n?C.removeClass+" disabled":C.removeClass;if(t){m=c._getLayoutTemplate("actionDelete").setTokens({removeClass:x,removeIcon:C.removeIcon,removeTitle:C.removeTitle,dataUrl:u,dataKey:p,key:o})}if(e){g=c._getLayoutTemplate("actionUpload").setTokens({uploadClass:C.uploadClass,uploadIcon:C.uploadIcon,uploadTitle:C.uploadTitle})}if(i){h=c._getLayoutTemplate("actionDownload").setTokens({downloadClass:C.downloadClass,downloadIcon:C.downloadIcon,downloadTitle:C.downloadTitle,downloadUrl:d||c.initialPreviewDownloadUrl});h=h.setTokens({filename:f,key:o})}if(a){v=c._getLayoutTemplate("actionZoom").setTokens({zoomClass:C.zoomClass,zoomIcon:C.zoomIcon,zoomTitle:C.zoomTitle})}if(r&&s){_="drag-handle-init "+C.dragClass;w=c._getLayoutTemplate("actionDrag").setTokens({dragClass:_,dragTitle:C.dragTitle,dragIcon:C.dragIcon})}return b.setTokens({delete:m,upload:g,download:h,zoom:v,drag:w,other:y})},_browse:function(e){var i=this;i._raise("filebrowse");if(e&&e.isDefaultPrevented()){return}if(i.isError&&!i.isUploadable){i.clear()}i.$captionContainer.focus()},_filterDuplicate:function(e,i,t){var a=this,r=a._getFileId(e);if(r&&t&&t.indexOf(r)>-1){return}if(!t){t=[]}i.push(e);t.push(r)},_change:function(t){var a=this,r=a.$element;if(!a.isUploadable&&i.isEmpty(r.val())&&a.fileInputCleared){a.fileInputCleared=false;return}a.fileInputCleared=false;var n=[],l,o,s=arguments.length>1,d=a.isUploadable,f,c,u=s?t.originalEvent.dataTransfer.files:r.get(0).files,p=a.filestack.length,m=i.isEmpty(r.attr("multiple")),g=m&&p>0,h=0,v=a._getFileIds(),w=function(i,t,r,n){var l=e.extend(true,{},a._getOutData({},{},u),{id:r,index:n}),o={id:r,index:n,file:t,files:u};return a.isUploadable?a._showUploadError(i,l):a._showError(i,o)};a.reader=null;a._resetUpload();a._hideFileIcon();if(a.isUploadable){a.$container.find(".file-drop-zone ."+a.dropZoneTitleClass).remove()}if(s){e.each(u,function(e,i){if(i&&!i.type&&i.size!==undefined&&i.size%4096===0){h++}else{a._filterDuplicate(i,n,v)}})}else{if(t.target&&t.target.files===undefined){u=t.target.value?[{name:t.target.value.replace(/^.+\\/,"")}]:[]}else{u=t.target.files||{}}if(d){e.each(u,function(e,i){a._filterDuplicate(i,n,v)})}else{n=u}}if(i.isEmpty(n)||n.length===0){if(!d){a.clear()}a._showFolderError(h);a._raise("fileselectnone");return}a._resetErrors();c=n.length;o=a._getFileCount(a.isUploadable?a.getFileStack().length+c:c);if(a.maxFileCount>0&&o>a.maxFileCount){if(!a.autoReplace||c>a.maxFileCount){f=a.autoReplace&&c>a.maxFileCount?c:o;l=a.msgFilesTooMany.replace("{m}",a.maxFileCount).replace("{n}",f);a.isError=w(l,null,null,null);a.$captionContainer.find(".kv-caption-icon").hide();a._setCaption("",true);a.$container.removeClass("file-input-new file-input-ajax-new");return}if(o>a.maxFileCount){a._resetPreviewThumbs(d)}}else{if(!d||g){a._resetPreviewThumbs(false);if(g){a.clearStack()}}else{if(d&&p===0&&(!a.previewCache.count()||a.overwriteInitial)){a._resetPreviewThumbs(true)}}}if(a.isPreviewable){a._readFiles(n)}else{a._updateFileDetails(1)}a._showFolderError(h)},_abort:function(i){var t=this,a;if(t.ajaxAborted&&typeof t.ajaxAborted==="object"&&t.ajaxAborted.message!==undefined){a=e.extend(true,{},t._getOutData(),i);a.abortData=t.ajaxAborted.data||{};a.abortMessage=t.ajaxAborted.message;t._setProgress(101,t.$progress,t.msgCancelled);t._showUploadError(t.ajaxAborted.message,a,"filecustomerror");t.cancel();return true}return false},_resetFileStack:function(){var t=this,a=0,r=[],n=[],l=[];t._getThumbs().each(function(){var o=e(this),s=o.attr("data-fileindex"),d=t.filestack[s],f=o.attr("id"),c;if(s==="-1"||s===-1){return}if(d!==undefined){r[a]=d;n[a]=t._getFileName(d);l[a]=t._getFileId(d);o.attr({id:t.previewInitId+"-"+a,"data-fileindex":a});a++}else{c="uploaded-"+i.uniqId();o.attr({id:c,"data-fileindex":"-1"});t.$preview.find("#zoom-"+f).attr("id","zoom-"+c)}});t.filestack=r;t.filenames=n;t.fileids=l},_isFileSelectionValid:function(e){var i=this;e=e||0;if(i.required&&!i.getFilesCount()){i.$errorContainer.html("");i._showUploadError(i.msgFileRequired);return false}if(i.minFileCount>0&&i._getFileCount(e)<i.minFileCount){i._noFilesError({});return false}return true},clearStack:function(){var e=this;e.filestack=[];e.filenames=[];e.fileids=[];return e.$element},updateStack:function(e,i){var t=this;t.filestack[e]=i;t.filenames[e]=t._getFileName(i);t.fileids[e]=i&&t._getFileId(i)||null;return t.$element},addToStack:function(e){var i=this;i.filestack.push(e);i.filenames.push(i._getFileName(e));i.fileids.push(i._getFileId(e));return i.$element},getFileStack:function(e){var i=this;return i.filestack.filter(function(i){return e?i!==undefined:i!==undefined&&i!==null})},getFilesCount:function(){var e=this,i=e.isUploadable?e.getFileStack().length:e.$element.get(0).files.length;return e._getFileCount(i)},lock:function(){var e=this;e._resetErrors();e.disable();if(e.showRemove){e.$container.find(".fileinput-remove").hide()}if(e.showCancel){e.$container.find(".fileinput-cancel").show()}e._raise("filelock",[e.filestack,e._getExtraData()]);return e.$element},unlock:function(e){var i=this;if(e===undefined){e=true}i.enable();if(i.showCancel){i.$container.find(".fileinput-cancel").hide()}if(i.showRemove){i.$container.find(".fileinput-remove").show()}if(e){i._resetFileStack()}i._raise("fileunlock",[i.filestack,i._getExtraData()]);return i.$element},cancel:function(){var i=this,t=i.ajaxRequests,a=t.length,r;if(a>0){for(r=0;r<a;r+=1){i.cancelling=true;t[r].abort()}}i._setProgressCancelled();i._getThumbs().each(function(){var t=e(this),a=t.attr("data-fileindex");t.removeClass("file-uploading");if(i.filestack[a]!==undefined){t.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled");t.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}i.unlock()});return i.$element},clear:function(){var t=this,a;if(!t._raise("fileclear")){return}t.$btnUpload.removeAttr("disabled");t._getThumbs().find("video,audio,img").each(function(){i.cleanMemory(e(this))});t._resetUpload();t.clearStack();t._clearFileInput();t._resetErrors(true);if(t._hasInitialPreview()){t._showFileIcon();t._resetPreview();t._initPreviewActions();t.$container.removeClass("file-input-new")}else{t._getThumbs().each(function(){t._clearObjects(e(this))});if(t.isUploadable){t.previewCache.data={}}t.$preview.html("");a=!t.overwriteInitial&&t.initialCaption.length>0?t.initialCaption:"";t.$caption.html(a);t.$caption.attr("title","");i.addCss(t.$container,"file-input-new");t._validateDefaultPreview()}if(t.$container.find(i.FRAMES).length===0){if(!t._initCaption()){t.$captionContainer.find(".kv-caption-icon").hide()}}t._hideFileIcon();t._raise("filecleared");t.$captionContainer.focus();t._setFileDropZoneTitle();return t.$element},reset:function(){var e=this;if(!e._raise("filereset")){return}e._resetPreview();e.$container.find(".fileinput-filename").text("");i.addCss(e.$container,"file-input-new");if(e.getFrames().length||e.isUploadable&&e.dropZoneEnabled){e.$container.removeClass("file-input-new")}e.clearStack();e.formdata={};e._setFileDropZoneTitle();return e.$element},disable:function(){var e=this;e.isDisabled=true;e._raise("filedisabled");e.$element.attr("disabled","disabled");e.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",true);i.addCss(e.$container.find(".btn-file"),"disabled");e._initDragDrop();return e.$element},enable:function(){var e=this;e.isDisabled=false;e._raise("fileenabled");e.$element.removeAttr("disabled");e.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled");e.$container.find(".btn-file").removeClass("disabled");e._initDragDrop();return e.$element},upload:function(){var t=this,a=t.getFileStack().length,r,n,l,o=!e.isEmptyObject(t._getExtraData());if(!t.isUploadable||t.isDisabled||!t._isFileSelectionValid(a)){return}t._resetUpload();if(a===0&&!o){t._showUploadError(t.msgUploadEmpty);return}t.$progress.show();t.uploadCount=0;t.uploadStatus={};t.uploadLog=[];t.lock();t._setProgress(2);if(a===0&&o){t._uploadExtraOnly();return}l=t.filestack.length;t.hasInitData=false;if(t.uploadAsync){n=t._getOutData();t._raise("filebatchpreupload",[n]);t.fileBatchCompleted=false;t.uploadCache={content:[],config:[],tags:[],append:true};t.uploadAsyncCount=t.getFileStack().length;for(r=0;r<l;r++){t.uploadCache.content[r]=null;t.uploadCache.config[r]=null;t.uploadCache.tags[r]=null}t.$preview.find(".file-preview-initial").removeClass(i.SORT_CSS);t._initSortable();t.cacheInitialPreview=t.getPreview();for(r=0;r<l;r++){if(t.filestack[r]){t._uploadSingle(r,true)}}return}t._uploadBatch();return t.$element},destroy:function(){var i=this,t=i.$form,a=i.$container,r=i.$element,n=i.namespace;e(document).off(n);e(window).off(n);if(t&&t.length){t.off(n)}if(i.isUploadable){i._clearFileInput()}i._cleanup();i._initPreviewCache();r.insertBefore(a).off(n).removeData();a.off().remove();return r},refresh:function(t,a){var r=this,n=r.$element;if(typeof t!=="object"||i.isEmpty(t)){t=r.options}else{t=e.extend(true,{},r.options,t)}r._init(t,true);r._listen();if(a){n.trigger("change"+r.namespace)}return n},zoom:function(e){var t=this,a=t._getFrame(e),r=t.$modal;if(!a){return}i.initModal(r);r.html(t._getModalContent());t._setZoomContent(a);r.modal("show");t._initZoomButtons()},getExif:function(e){var i=this,t=i._getFrame(e);return t&&t.data("exif")||null},getFrames:function(e){var t=this;e=e||"";return t.$preview.find(i.FRAMES+e)},getPreview:function(){var e=this;return{content:e.initialPreview,config:e.initialPreviewConfig,tags:e.initialPreviewThumbTags}}};e.fn.fileinput=function(a){if(!i.hasFileAPISupport()&&!i.isIE(9)){return}var r=Array.apply(null,arguments),n=[];r.shift();this.each(function(){var l=e(this),o=l.data("fileinput"),s=typeof a==="object"&&a,d=s.theme||l.data("theme"),f={},c={},u=s.language||l.data("language")||e.fn.fileinput.defaults.language||"en",p;if(!o){if(d){c=e.fn.fileinputThemes[d]||{}}if(u!=="en"&&!i.isEmpty(e.fn.fileinputLocales[u])){f=e.fn.fileinputLocales[u]||{}}p=e.extend(true,{},e.fn.fileinput.defaults,c,e.fn.fileinputLocales.en,f,s,l.data());o=new t(this,p);l.data("fileinput",o)}if(typeof a==="string"){n.push(o[a].apply(o,r))}});switch(n.length){case 0:return this;case 1:return n[0];default:return n}};e.fn.fileinput.defaults={language:"en",showCaption:true,showBrowse:true,showPreview:true,showRemove:true,showUpload:true,showCancel:true,showClose:true,showUploadedThumbs:true,browseOnZoneClick:false,autoReplace:false,autoOrientImage:true,required:false,rtl:false,hideThumbnailContent:false,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:true,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:false,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:true,initialPreviewDownloadUrl:"",removeFromPreviewOnError:false,deleteUrl:"",deleteExtraData:{},overwriteInitial:true,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-secondary btn-header-toggle",fullscreen:"btn btn-default btn-secondary",borderless:"btn btn-default btn-secondary",close:"btn btn-default btn-secondary"},preferIconicPreview:false,preferIconicZoomPreview:false,allowedPreviewTypes:undefined,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:true,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:false,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:false,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<button class="close kv-error-close">&times;</button>',slugCallback:null,dropZoneEnabled:true,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:true,mergeAjaxCallbacks:false,mergeAjaxDeleteCallbacks:false,retryErrorUploads:true};e.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};e.fn.fileinput.Constructor=t;e(document).ready(function(){var i=e("input.file[type=file]");if(i.length){i.fileinput()}})});