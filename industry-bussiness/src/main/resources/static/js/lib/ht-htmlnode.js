!function(I){"use strict";var d="ht",y=I[d],z=function(){return document},V=function(){return z().body},B=function(X,G,Y){X.style.setProperty(G,Y,null)},o=function(O){return z().createElement(O)},A=function(){return o("div")},S=function(){var u=o("canvas");return u},c=function(R,g){B(R,"-webkit-transform",g),B(R,"-ms-transform",g),B(R,"transform",g)},r=function(m,x){B(m,"-webkit-transform-origin",x),B(m,"-ms-transform-origin",x),B(m,"transform-origin",x)},m=function(o,p){o.appendChild(p)},W=function(k,$){k.removeChild($)},t=I.parseInt,P=y.Default,l=P.getInternal(),T=Math.PI,$="white-space",X="visibility",q="left",n="top",R="width",Q="height",O="position",C="display",s="z-index",f="px",u="0 0",Y="absolute",L="visible",Z="hidden",i="none",E="block",h="nowrap",e="rgba(0, 0, 0, 0.005)";P.setImage("node_dragger","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAN9JREFUeNrsV9sNhDAMKyzQVdgARmGzrMJNUFZhAh6nfkVcG9PQgHSR8lEksJs6pnGuLCimSRzAa0yyBK9O4gy8GokU+O0kJOAwiQYg0LP1xNYDW3+0CfBYNb7VOuN4LAGpiOaYUhFDas9F2NPHDELNENJqaHgBgSQJ3ufakfQJqckERcOiK+Ae1FGWBNKGh9oX5WPpLpdNYfffijbsxTHh7VKP7388n1g1h7OKUoUuyGpJakQEuhwkZAKcDXVOdWcrOrL/feBVBHI/q8fcjE1nA9PpyHQ+NJ2Qi8A3AQYAOtS27fCoRY0AAAAASUVORK5CYII=");var a=y.graph.GraphView.prototype,k=a.draw;a.adjustHtmlNodeIndex=!0,a.draw=function($,v){if(k.call(this,$,v),this.adjustHtmlNodeIndex)for(var R=this.getDataModel()._datas._as,P=R.length,t=1,z=0;P>z;z++){var g=R[z];if(g instanceof j){var h=this.getDataUI(g);B(h._contentDiv,s,t+""),B(h._draggerCanvas,s,t+1+""),t+=2}}};var w=y.HtmlNodeUI=function(m,V){var q=this;w.superClass.constructor.call(q,m,V);var g=q._contentDiv=A(),I=q._draggerCanvas=S();B(g,O,Y),B(g,X,Z),B(g,$,h),I.draggable=!1,B(I,O,Y),B(I,C,i),r(I,u),g.addEventListener("change",function(e){var f=e.target,v=f.bind||f.getAttribute("bind"),I=f.type&&"checkbox"===f.type?f.checked:f.value,Q=V.getContext();v&&Q&&(Q[v]=I,q._contextJSON=JSON.stringify(Q))}),["mousedown","touchstart","keydown","mousewheel","DOMMouseScroll"].forEach(function(I){g.addEventListener(I,this._stopPropagation.bind(this))},q)};P.def(w,l.ui().NodeUI,{_drawDragger:function(){var C=this,b=C._draggerCanvas,s=C._data,g=s.getDraggerImageWidth(),X=s.getDraggerImageHeight(),Q=s.getDraggerImage(),y=l.initContext(b);y.beginPath(),l.setCanvas(b,g,X),l.translateAndScale(y,0,0,1),y.clearRect(0,0,g,X),P.drawImage(y,P.getImage(Q),0,0,g,X),y.restore()},drawBody:function(y){w.superClass.drawBody.call(this,y);var N=this,a=N._data,J=a._padding,V=2*J,d=N._contentDiv,F=N._draggerCanvas,o=N.gv,W=o.getZoom(),S=o.getTranslateX(),H=o.getTranslateY(),h=o.getView(),_=N._nodeInfo,k=a._width,$=a._height,l=_.position,g=_.rotation,I=(k-V)/a._originDivWidth*W,r=($-V)/a._originDivHeight*W,u=N._html,D=a._html,p=a.getHtmlType();if("html"===p){var G=a.getContext()||{},v=N._contextJSON,z=a._template,K=JSON.stringify(G);u&&v&&u===D&&v===K||(N._contextJSON=K,N._html=D,d.innerHTML=z?z(G):D)}else if(null!=p){var P=a.getHtml();"ht"===p&&(P=P.getView()),u&&u===P||(N._html=P,d.innerHTML="",m(d,P))}if(!d.parentNode){var x=o.htmlNodeDiv;if(!x){var j=A();B(j,O,Y),B(j,s,"0"),x=o.htmlNodeDiv=j;var U=o._canvas.nextSibling;U?h.insertBefore(j,U):m(h,j)}m(x,d),m(x,F)}if(a._scalable){var b=a._originDivWidth,Z=a._originDivHeight;c(d,"rotate("+180*(g/T)+"deg) scale("+I+","+r+")"),B(d,q,(l.x-b/W/2)*W+S+f),B(d,n,(l.y-Z/W/2)*W+H+f)}else{var M=t(d.style.width),Zg=t(d.style.height),fq=t((k-V)*W),Vq=t(($-V)*W),oo="100%",vr=d.children[0];B(vr,R,oo),B(vr,Q,oo),(M!==fq||Zg!==Vq)&&(B(d,R,fq+f),B(d,Q,Vq+f),"ht"===p&&D.invalidate()),c(d,"rotate("+180*(g/T)+"deg)"),B(d,q,(l.x-fq/W/2)*W+S+f),B(d,n,(l.y-Vq/W/2)*W+H+f)}var dn=N.dragRect;o.isMovable(a)&&o.isSelected(a)&&dn?(y.save(),y.fillStyle=e,y.fillRect(dn.x,dn.y,dn.width,dn.height),y.restore(),B(F,q,dn.x*W+S+f),B(F,n,dn.y*W+H+f),c(F,"scale("+W+","+W+")"),B(F,C,E),N._drawDragger()):B(F,C,i),B(d,X,L)},dispose:function(){var $=this.gv.htmlNodeDiv;$.removeChild(this._contentDiv),$.removeChild(this._draggerCanvas)},onVisibleChanged:function(w){B(this._contentDiv,X,w?L:Z),B(this._draggerCanvas,C,w?E:i)},prepareCreateBounds:function(){var F=this,Y=F._data;w.superClass.prepareCreateBounds.call(F);var d=Y.getRect();F.dragRect={x:d.x+d.width+Y._padding,y:d.y+10,width:Y.getDraggerImageWidth(),height:Y.getDraggerImageHeight()},F.addRect(F.dragRect)},_stopPropagation:function(l){if("mousedown"===l.type||"touchstart"===l.type){var Y=this.gv,u=Y.sm(),q=this._data;P.isCtrlDown(l)?u.co(q)?u.removeSelection(q):u.appendSelection(q):u.co(q)||u.setSelection(q)}l.stopPropagation()}});var j=y.HtmlNode=function(){j.superClass.constructor.call(this)};y.Default.def(j,y.Node,{ms_ac:["html","context","scalable","padding","draggerImage","draggerImageWidth","draggerImageHeight"],_padding:y.Default.isTouchable?12:6,_image:null,_scalable:!0,_draggerImage:"node_dragger",_draggerImageWidth:20,_draggerImageHeight:20,setHtml:function(O){var L=this,m=L._html;L._html=O,"html"===L.getHtmlType()&&"Handlebars"in I&&(L._template=Handlebars.compile(O)),L._calculateNodeSize(),L.fp("html",m,O)},setContext:function(L){var w=this,t=w._context;w._context=L,w.fp("context",t,L),w._calculateNodeSize()},setScalable:function(c){var W=this,r=W._scalable;W._scalable=c,W.fp("scalable",r,c),W._calculateNodeSize()},getHtmlType:function(){var g=this._html;return g?"string"==typeof g?"html":g.getView?"ht":"dom":null},_calculateNodeSize:function(){var f=this,G=f._html,R=f._template;if(G){var z=A(),n=!1,S=f.getHtmlType();if(B(z,O,Y),B(z,$,h),B(z,X,Z),"html"===S?(z.innerHTML=R?R(f.getContext()||{}):G,n=!0):"ht"===S?(m(z,G.getView()),n=!0):"dom"===S&&(m(z,G),n=!0),n){var p=2*f._padding;m(V(),z),f._originDivWidth=z.scrollWidth,f._originDivHeight=z.scrollHeight,f._width=f._originDivWidth+p,f._height=f._originDivHeight+p,f._originWidth=f._width,f._originHeight=f._height,W(V(),z)}}},getUIClass:function(){return y.HtmlNodeUI}})}(this,Object);