(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"&&typeof require==="function"){e(require("jquery"))}else{e(jQuery)}})(function(e){"use strict";var t=function(){return{escapeRegExChars:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");t.className=e;t.style.position="absolute";t.style.display="none";return t}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},i=e.noop;function s(t,n){var i=this;i.element=t;i.el=e(t);i.suggestions=[];i.badQueries=[];i.selectedIndex=-1;i.currentValue=i.element.value;i.timeoutId=null;i.cachedResponse={};i.onChangeTimeout=null;i.onChange=null;i.isLocal=false;i.x=0;i.y=0;i.suggestionsContainer=null;i.noSuggestionsContainer=null;i.options=e.extend({},s.defaults,n);i.classes={selected:"autoSelect-selected",suggestion:"autoSelect-suggestion"};i.hint=null;i.hintValue="";i.selection=null;i.setOptions(n);i.initialize()}s.utils=t;e.autoSelect=s;s.defaults={ajaxSettings:{},autoSelectFirst:false,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:r,formatGroup:u,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:i,onSearchComplete:i,onSearchError:i,preserveInput:false,containerClass:"autoSelect-suggestions",tabDisabled:false,dataType:"text",currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:o,paramName:"query",transformResult:a,showNoSuggestionNotice:false,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:false,dropContainer:null,clickCallback:null,data:null};function o(e,t,n){return e.value.toLowerCase().indexOf(n)!==-1}function a(t){return typeof t==="string"?e.parseJSON(t):t}function r(e,n){if(!n){return e.value}var i="("+t.escapeRegExChars(n)+")";return e.value.replace(new RegExp(i,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")}function u(e,t){return'<div class="autoSelect-group">'+t+"</div>"}s.prototype={initialize:function(){var t=this;var n="."+t.classes.suggestion;var i=t.classes.selected;var o=t.options;var a;t.element.setAttribute("autoSelect","off");t.noSuggestionsContainer=e('<div class="autoSelect-no-suggestion"></div>').html(t.options.noSuggestionNotice).get(0);t.suggestionsContainer=s.utils.createNode(o.containerClass);a=e(t.suggestionsContainer);a.appendTo(o.appendTo||"body");if(o.width!=="auto"){a.css("width",o.width)}a.on("mouseover.autoSelect",n,function(){t.activate(e(this).data("index"))});a.on("mouseout.autoSelect",function(){t.selectedIndex=-1;a.children("."+i).removeClass(i)});a.on("click.autoSelect",n,function(){t.select(e(this).data("index"));if(o.clickCallback){var n=e(this).data("index");e(".autoSelect-suggestion").each(function(t,i){if(e(i).attr("data-index")==n){var s=null;e(o.data).each(function(t,n){if(n.data==e(i).attr("data-id")){o.data=n;return false}})}});o.clickCallback(o.data)}});a.on("click.autoSelect",function(){clearTimeout(t.blurTimeoutId)});t.fixPositionCapture=function(){if(t.visible){t.fixPosition()}};e(window).on("resize.autoSelect",t.fixPositionCapture);t.el.on("keydown.autoSelect",function(e){t.onKeyPress(e)});t.el.on("keyup.autoSelect",function(e){t.onKeyUp(e)});t.el.on("blur.autoSelect",function(){t.onBlur()});t.el.on("focus.autoSelect",function(){t.onFocus()});t.el.on("change.autoSelect",function(e){t.onKeyUp(e)});t.el.on("input.autoSelect",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition();if(e.el.val().length>=e.options.minChars){e.onValueChange()}},onBlur:function(){var e=this;e.blurTimeoutId=setTimeout(function(){e.hide()},200)},abortAjax:function(){var e=this;if(e.currentRequest){e.currentRequest.abort();e.currentRequest=null}},setOptions:function(t){var n=this,i=n.options;this.options=e.extend({},i,t);n.isLocal=e.isArray(i.lookup);if(n.isLocal){i.lookup=n.verifySuggestionsFormat(i.lookup)}i.orientation=n.validateOrientation(i.orientation,"bottom");e(n.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex})},clearCache:function(){this.cachedResponse={};this.badQueries=[]},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[]},disable:function(){var e=this;e.disabled=true;clearTimeout(e.onChangeTimeout);e.abortAjax()},enable:function(){this.disabled=false},fixPosition:function(){var t=this,n=e(t.suggestionsContainer),i=n.parent().get(0);if(i!==document.body&&!t.options.forceFixPosition){return}var s=t.options.orientation,o=n.outerHeight(),a=t.el.outerHeight(),r=t.el.offset(),u={top:r.top,left:r.left};if(s==="auto"){var l=e(window).height(),c=e(window).scrollTop(),g=-c+r.top-o,f=c+l-(r.top+a+o);s=Math.max(g,f)===g?"top":"bottom"}if(s==="top"){u.top+=-o}else{u.top+=a}if(i!==document.body){var d=n.css("opacity"),h;if(!t.visible){n.css("opacity",0).show()}h=n.offsetParent().offset();u.top-=h.top;u.left-=h.left;if(!t.visible){n.css("opacity",d).hide()}}if(t.options.width==="auto"){u.width=t.el.outerWidth()+"px"}n.css(u)},isCursorAtEnd:function(){var e=this,t=e.el.val().length,n=e.element.selectionStart,i;if(typeof n==="number"){return n===t}if(document.selection){i=document.selection.createRange();i.moveStart("character",-t);return t===i.text.length}return true},onKeyPress:function(e){var t=this;var i=t.options;if(!t.disabled&&!t.visible&&e.which===n.DOWN&&t.currentValue){t.suggest();return}if(t.disabled||!t.visible){return}switch(e.which){case n.ESC:t.el.val(t.currentValue);t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint){t.selectHint();return}if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);if(t.options.tabDisabled===false){return}break;case n.RETURN:if(t.selectedIndex===-1){t.hide();return}t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp:function(e){var t=this;if(t.disabled){return}switch(e.which){case n.UP:case n.DOWN:return}clearTimeout(t.onChangeTimeout);if(t.currentValue!==t.el.val()){t.findBestHint();if(t.options.deferRequestBy>0){t.onChangeTimeout=setTimeout(function(){t.onValueChange()},t.options.deferRequestBy)}else{t.onValueChange()}}},onValueChange:function(){var t=this,n=t.options,i=t.el.val(),s=t.getQuery(i);if(t.selection&&t.currentValue!==s){t.selection=null;(n.onInvalidateSelection||e.noop).call(t.element)}clearTimeout(t.onChangeTimeout);t.currentValue=i;t.selectedIndex=-1;if(n.triggerSelectOnValidInput&&t.isExactMatch(s)){t.select(0);return}if(s.length<n.minChars){t.hide()}else{t.getSuggestions(s)}},isExactMatch:function(e){var t=this.suggestions;return t.length===1&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(t){var n=this.options.delimiter,i;if(!n){return t}i=t.split(n);return e.trim(i[i.length-1])},getSuggestionsLocal:function(t){var n=this,i=n.options,s=t.toLowerCase(),o=i.lookupFilter,a=parseInt(i.lookupLimit,10),r;r={suggestions:e.grep(i.lookup,function(e){return o(e,t,s)})};if(a&&r.suggestions.length>a){r.suggestions=r.suggestions.slice(0,a)}return r},getSuggestions:function(t){var n,i=this,s=i.options,o=s.serviceUrl,a,r,u;s.params[s.paramName]=t;if(s.onSearchStart.call(i.element,s.params)===false){return}a=s.ignoreParams?null:s.params;if(e.isFunction(s.lookup)){s.lookup(t,function(e){i.suggestions=e.suggestions;i.suggest();s.onSearchComplete.call(i.element,t,e.suggestions)});return}if(i.isLocal){n=i.getSuggestionsLocal(t);console.log(n)}else{if(e.isFunction(o)){o=o.call(i.element,t)}r=o+"?"+e.param(a||{});n=i.cachedResponse[r]}if(n&&e.isArray(n.suggestions)){i.suggestions=n.suggestions;i.suggest();s.onSearchComplete.call(i.element,t,n.suggestions)}else if(!i.isBadQuery(t)){i.abortAjax();u={url:o,data:a,type:s.type,dataType:s.dataType};e.extend(u,s.ajaxSettings);i.currentRequest=e.ajax(u).done(function(e){var n;i.currentRequest=null;n=s.transformResult(e,t);i.processResponse(n,t,r);s.onSearchComplete.call(i.element,t,n.suggestions)}).fail(function(e,n,o){s.onSearchError.call(i.element,t,e,n,o)})}else{s.onSearchComplete.call(i.element,t,[])}},isBadQuery:function(e){if(!this.options.preventBadQueries){return false}var t=this.badQueries,n=t.length;while(n--){if(e.indexOf(t[n])===0){return true}}return false},hide:function(){var t=this,n=e(t.suggestionsContainer);if(e.isFunction(t.options.onHide)&&t.visible){t.options.onHide.call(t.element,n)}t.visible=false;t.selectedIndex=-1;clearTimeout(t.onChangeTimeout);e(t.suggestionsContainer).hide();t.signalHint(null)},suggest:function(){if(!this.suggestions.length){if(this.options.showNoSuggestionNotice){this.noSuggestions()}else{this.hide()}return}var t=this,n=t.options,i=n.groupBy,s=n.formatResult,a=t.getQuery(t.currentValue),r=t.classes.suggestion,u=t.classes.selected,l=e(t.suggestionsContainer),c=e(t.noSuggestionsContainer),g=n.beforeRender,f="",d,h=function(e,t){var s=e.data[i];if(d===s){return""}d=s;return n.formatGroup(e,d)};if(n.triggerSelectOnValidInput&&t.isExactMatch(a)){t.select(0);return}t.suggestions=e.grep(t.suggestions,function(e,t){return o(e,a,a.toLowerCase())});e.each(t.suggestions,function(e,t){if(i){f+=h(t,a,e)}f+='<div class="'+r+'" data-index="'+e+'" data-id="'+t.data+'">'+s(t,a,e)+"</div>"});this.adjustContainerWidth();c.detach();l.html(f);if(e.isFunction(g)){g.call(t.element,l,t.suggestions)}t.fixPosition();l.show();if(n.autoSelectFirst){t.selectedIndex=0;l.scrollTop(0);l.children("."+r).first().addClass(u)}t.visible=true;t.findBestHint();n.data=t.suggestions},noSuggestions:function(){var t=this,n=t.options.beforeRender,i=e(t.suggestionsContainer),s=e(t.noSuggestionsContainer);this.adjustContainerWidth();s.detach();i.empty();i.append(s);if(e.isFunction(n)){n.call(t.element,i,t.suggestions)}t.fixPosition();i.show();t.visible=true},adjustContainerWidth:function(){var t=this,n=t.options,i,s=e(t.suggestionsContainer);if(n.width==="auto"){i=t.el.outerWidth();s.css("width",i>0?i:300)}else if(n.width==="flex"){s.css("width","")}},findBestHint:function(){var t=this,n=t.el.val().toLowerCase(),i=null;if(!n){return}e.each(t.suggestions,function(e,t){var s=t.value.toLowerCase().indexOf(n)===0;if(s){i=t}return!s});t.signalHint(i)},signalHint:function(t){var n="",i=this;if(t){n=i.currentValue+t.value.substr(i.currentValue.length)}if(i.hintValue!==n){i.hintValue=n;i.hint=t;(this.options.onHint||e.noop)(n)}},verifySuggestionsFormat:function(t){if(t.length&&typeof t[0]==="string"){return e.map(t,function(e){return{value:e,data:null}})}return t},validateOrientation:function(t,n){t=e.trim(t||"").toLowerCase();if(e.inArray(t,["auto","bottom","top"])===-1){t=n}return t},processResponse:function(e,t,n){var i=this,s=i.options;e.suggestions=i.verifySuggestionsFormat(e);if(!s.noCache){i.cachedResponse[n]=e;if(s.preventBadQueries&&!e.suggestions.length){i.badQueries.push(t)}}if(t!==i.getQuery(i.currentValue)){return}i.suggestions=e.suggestions;i.suggest()},activate:function(t){var n=this,i,s=n.classes.selected,o=e(n.suggestionsContainer),a=o.find("."+n.classes.suggestion);o.find("."+s).removeClass(s);n.selectedIndex=t;if(n.selectedIndex!==-1&&a.length>n.selectedIndex){i=a.get(n.selectedIndex);e(i).addClass(s);return i}return null},selectHint:function(){var t=this,n=e.inArray(t.hint,t.suggestions);t.select(n)},select:function(e){var t=this;t.hide();t.onSelect(e)},moveUp:function(){var t=this;if(t.selectedIndex===-1){return}if(t.selectedIndex===0){e(t.suggestionsContainer).children().first().removeClass(t.classes.selected);t.selectedIndex=-1;t.el.val(t.currentValue);t.findBestHint();return}t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;if(e.selectedIndex===e.suggestions.length-1){return}e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n=this,i=n.activate(t);if(!i){return}var s,o,a,r=e(i).outerHeight();s=i.offsetTop;o=e(n.suggestionsContainer).scrollTop();a=o+n.options.maxHeight-r;if(s<o){e(n.suggestionsContainer).scrollTop(s)}else if(s>a){e(n.suggestionsContainer).scrollTop(s-n.options.maxHeight+r)}if(!n.options.preserveInput){n.el.val(n.getValue(n.suggestions[t].value))}n.signalHint(null)},onSelect:function(t){var n=this,i=n.options.onSelect,s=n.suggestions[t];n.currentValue=n.getValue(s.value);if(n.currentValue!==n.el.val()&&!n.options.preserveInput){n.el.val(n.currentValue)}n.signalHint(null);n.suggestions=[];n.selection=s;if(e.isFunction(i)){i.call(n.element,s)}},getValue:function(e){var t=this,n=t.options.delimiter,i,s;if(!n){return e}i=t.currentValue;s=i.split(n);if(s.length===1){return e}return i.substr(0,i.length-s[s.length-1].length)+e},dispose:function(){var t=this;t.el.off(".autoSelect").removeData("autoSelect");e(window).off("resize.autoSelect",t.fixPositionCapture);e(t.suggestionsContainer).remove()}};e.fn.devbridgeAutocomplete=function(t,n){var i="autoSelect";if(!arguments.length){return this.first().data(i)}return this.each(function(){var o=e(this),a=o.data(i);if(typeof t==="string"){if(a&&typeof a[t]==="function"){a[t](n)}}else{if(a&&a.dispose){a.dispose()}a=new s(this,t);o.data(i,a)}})};if(!e.fn.autoSelect){e.fn.autoSelect=e.fn.devbridgeAutocomplete}});